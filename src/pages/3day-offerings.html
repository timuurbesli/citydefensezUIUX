<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Defense Z - Traveler's Trade</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Reset and Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('../assets/images/bg-cdz.jpg') center/cover no-repeat;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        /* Background Blur */
        .game-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('../assets/images/bg-cdz.jpg') center/cover no-repeat;
            filter: blur(3px) brightness(0.4);
            z-index: 1;
        }

        /* Modal Overlay */
        .traveler-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at center, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.9) 100%),
                linear-gradient(135deg, #1a1612 0%, #2d241a 50%, #1a1612 100%);
            z-index: 1000;
            animation: fadeIn 0.5s ease-out;
            padding: 20px;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Main Modal Container */
        .traveler-modal {
            width: 100%;
            height: 100%;
            background: transparent;
            border: 3px solid #D2691E;
            border-radius: 20px;
            box-shadow: 
                0 0 60px rgba(210, 105, 30, 0.6),
                0 0 120px rgba(210, 105, 30, 0.3),
                inset 0 0 40px rgba(210, 105, 30, 0.1),
                inset 0 2px 0 rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
            animation: traderModalEntrance 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
        }

        @keyframes traderModalEntrance {
            0% { 
                opacity: 0; 
                transform: scale(0.7) translateY(-100px) rotateX(10deg); 
            }
            60% { 
                opacity: 0.8; 
                transform: scale(1.05) translateY(10px) rotateX(-2deg); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1) translateY(0) rotateX(0deg); 
            }
        }

        /* Animated Border Effect */
        .traveler-modal::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #D2691E, #DEB887, #CD853F, #D2691E);
            border-radius: 15px;
            z-index: -1;
            animation: traderBorderGlow 3s ease-in-out infinite alternate;
        }

        @keyframes traderBorderGlow {
            from { 
                box-shadow: 0 0 20px rgba(210, 105, 30, 0.3);
                filter: hue-rotate(0deg);
            }
            to { 
                box-shadow: 0 0 40px rgba(210, 105, 30, 0.6);
                filter: hue-rotate(10deg);
            }
        }

        /* Close Button */
        .close-button {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            color: #D2691E;
            font-size: 32px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-button:hover {
            color: #CD853F;
            transform: scale(1.2) rotate(90deg);
            background: rgba(210, 105, 30, 0.1);
            box-shadow: 0 0 20px rgba(210, 105, 30, 0.3);
        }

        /* Header Section */
        .traveler-header {
            padding: 25px 80px 20px 25px;
            border-bottom: 2px solid rgba(210, 105, 30, 0.4);
            background: 
                linear-gradient(135deg, rgba(210, 105, 30, 0.15), rgba(222, 184, 135, 0.08)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
            border-radius: 20px 20px 0 0;
            flex-shrink: 0;
        }

        .traveler-title {
            font-size: 42px;
            font-weight: 900;
            color: #D2691E;
            text-shadow: 
                0 0 35px rgba(210, 105, 30, 0.8),
                0 0 70px rgba(210, 105, 30, 0.4),
                3px 3px 10px rgba(0, 0, 0, 0.8);
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: 3px;
            font-family: 'Orbitron', monospace;
        }

        .traveler-subtitle {
            font-size: 20px;
            color: #DEB887;
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
            text-shadow: 
                0 0 18px rgba(222, 184, 135, 0.6),
                2px 2px 6px rgba(0, 0, 0, 0.7);
            font-weight: 300;
        }

        /* Cooldown Timer */
        .merchant-timer {
            position: absolute;
            top: 20px;
            right: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.3), rgba(139, 0, 0, 0.2));
            border-radius: 10px;
            border: 2px solid rgba(220, 20, 60, 0.4);
            min-width: 200px;
            z-index: 20;
        }

        .timer-label {
            font-size: 11px;
            color: #FFB6C1;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .timer-display {
            font-size: 16px;
            font-weight: bold;
            color: #FF6B6B;
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        .timer-bar-container {
            width: 160px;
            height: 4px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 2px;
            margin-top: 6px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B6B, #FF4757);
            border-radius: 2px;
            transition: width 1s ease;
            box-shadow: 0 0 8px rgba(255, 107, 107, 0.5);
            width: 50%; /* Example: 50% time remaining (1 day out of 2) */
        }

        /* Resource Display */
        .resource-display {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .resource-item-display {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            min-width: 70px;
            justify-content: center;
        }

        .resource-item-display:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.05);
        }

        .resource-item-display .resource-icon {
            font-size: 14px;
            flex-shrink: 0;
        }

        .resource-item-display .resource-value {
            font-weight: bold;
            font-size: 14px;
            color: white;
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        /* Resource color coding */
        .resource-item-display.resource .resource-icon { color: #FFD700; }
        .resource-item-display.ammunition .resource-icon { color: #32CD32; }
        .resource-item-display.food .resource-icon { color: #DC143C; }
        .resource-item-display.research .resource-icon { color: #4169E1; }



        /* Main Content Area */
        .traveler-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px 25px 20px;
            min-height: 0;
        }

        /* Trade Cards Container */
        .trades-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex: 1;
            align-items: center;
            flex-wrap: wrap;
            padding: 10px 0;
            min-height: 0;
        }

        /* Individual Trade Card */
        .trade-card {
            width: 350px;
            height: 500px;
            background: 
                linear-gradient(135deg, rgba(25, 20, 15, 0.95), rgba(35, 28, 20, 0.92), rgba(30, 24, 18, 0.95)),
                radial-gradient(circle at 70% 30%, rgba(210, 105, 30, 0.08) 0%, transparent 50%);
            border: 2px solid rgba(210, 105, 30, 0.4);
            border-radius: 18px;
            padding: 0;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: cardStaggerIn 0.8s ease-out;
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 12px 35px rgba(0, 0, 0, 0.7),
                0 1px 0 rgba(255, 255, 255, 0.05) inset,
                0 0 0 1px rgba(210, 105, 30, 0.3);
        }

        .trade-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(210, 105, 30, 0.05), transparent 30%, rgba(210, 105, 30, 0.02));
            border-radius: 18px;
            pointer-events: none;
        }

        .offering-card:nth-child(1) { animation-delay: 0.2s; }
        .offering-card:nth-child(2) { animation-delay: 0.4s; }
        .offering-card:nth-child(3) { animation-delay: 0.6s; }

        @keyframes cardStaggerIn {
            0% { 
                opacity: 0; 
                transform: translateY(50px) rotateX(45deg) scale(0.8); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) rotateX(0deg) scale(1); 
            }
        }

        .trade-card:hover {
            transform: translateY(-15px) scale(1.05);
            box-shadow: 
                0 25px 70px rgba(0, 0, 0, 0.8),
                0 10px 30px rgba(210, 105, 30, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
        }

        /* Trade Card States */
        .trade-card.affordable {
            border-color: rgba(205, 133, 63, 0.6);
            background: 
                linear-gradient(135deg, rgba(25, 20, 15, 0.95), rgba(35, 28, 20, 0.92), rgba(30, 24, 18, 0.95)),
                radial-gradient(circle at 70% 30%, rgba(205, 133, 63, 0.12) 0%, transparent 50%);
        }

        .trade-card.affordable:hover {
            border-color: rgba(210, 105, 30, 0.8);
            box-shadow: 
                0 15px 45px rgba(0, 0, 0, 0.8),
                0 5px 15px rgba(210, 105, 30, 0.3),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }

        .trade-card.unaffordable {
            border-color: rgba(105, 105, 105, 0.5);
            background: 
                linear-gradient(135deg, rgba(20, 18, 16, 0.95), rgba(25, 22, 19, 0.92), rgba(22, 20, 17, 0.95)),
                radial-gradient(circle at 70% 30%, rgba(105, 105, 105, 0.08) 0%, transparent 50%);
            opacity: 0.7;
            cursor: not-allowed;
        }

        .trade-card.unaffordable:hover {
            transform: none;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.7);
        }

        /* Cost Section */
        .cost-section {
            height: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            background: 
                linear-gradient(135deg, rgba(220, 20, 60, 0.15), rgba(139, 0, 0, 0.08)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.03) 0%, transparent 100%);
            border-radius: 18px 18px 0 0;
        }

        .cost-label {
            font-size: 14px;
            font-weight: 800;
            color: #FFB6C1;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 182, 193, 0.5);
            font-family: 'Orbitron', monospace;
        }

        .cost-amount {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 32px;
            font-weight: 900;
            color: #FF4757;
            font-family: 'Orbitron', monospace;
            text-shadow: 
                0 0 18px rgba(255, 71, 87, 0.6),
                2px 2px 6px rgba(0, 0, 0, 0.8);
            flex-wrap: nowrap;
        }

        .cost-icon {
            font-size: 26px;
            filter: drop-shadow(0 0 8px rgba(255, 71, 87, 0.4));
        }

        /* Exchange Arrow */
        .exchange-arrow {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: 
                linear-gradient(135deg, rgba(255, 165, 0, 0.25), rgba(255, 140, 0, 0.15)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .exchange-arrow::before {
            content: '';
            position: absolute;
            left: 20%;
            right: 20%;
            top: 50%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #FFA500, transparent);
            transform: translateY(-50%);
        }

        .arrow-icon {
            font-size: 34px;
            color: #FFA500;
            animation: arrowPulse 2.5s ease-in-out infinite;
            text-shadow: 
                0 0 15px rgba(255, 165, 0, 0.8),
                2px 2px 6px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 0 12px rgba(255, 165, 0, 0.5));
        }

        @keyframes arrowPulse {
            0%, 100% { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
            50% { 
                transform: translateY(4px) scale(1.1); 
                opacity: 0.8; 
            }
        }

        /* Benefit Section */
        .benefit-section {
            height: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            background: 
                linear-gradient(135deg, rgba(50, 205, 50, 0.15), rgba(34, 139, 34, 0.08)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.03) 0%, transparent 100%);
        }

        .benefit-label {
            font-size: 14px;
            font-weight: 800;
            color: #7FFF7F;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(127, 255, 127, 0.5);
            font-family: 'Orbitron', monospace;
        }

        .benefit-amount {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 32px;
            font-weight: 900;
            color: #2ED573;
            font-family: 'Orbitron', monospace;
            text-shadow: 
                0 0 18px rgba(46, 213, 115, 0.6),
                2px 2px 6px rgba(0, 0, 0, 0.8);
            flex-wrap: nowrap;
        }

        .benefit-icon {
            font-size: 26px;
            filter: drop-shadow(0 0 8px rgba(46, 213, 115, 0.4));
        }

        /* Trade Category Badge */
        .trade-category {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
        }

        .category-badge {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: help;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            position: relative;
            overflow: hidden;
        }

        .category-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .category-badge:hover::before {
            left: 100%;
        }

        .category-badge.profit {
            background: 
                linear-gradient(135deg, rgba(46, 213, 115, 0.4), rgba(34, 139, 34, 0.3)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            color: #7FFF7F;
            border: 2px solid rgba(46, 213, 115, 0.6);
            text-shadow: 0 0 10px rgba(127, 255, 127, 0.5);
            box-shadow: 0 0 15px rgba(46, 213, 115, 0.2);
        }

        .category-badge.bulk {
            background: 
                linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 140, 0, 0.3)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            color: #FFFACD;
            border: 2px solid rgba(255, 215, 0, 0.6);
            text-shadow: 0 0 10px rgba(255, 250, 205, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .category-badge.growth {
            background: 
                linear-gradient(135deg, rgba(65, 105, 225, 0.4), rgba(25, 25, 112, 0.3)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            color: #E6E6FA;
            border: 2px solid rgba(65, 105, 225, 0.6);
            text-shadow: 0 0 10px rgba(230, 230, 250, 0.5);
            box-shadow: 0 0 15px rgba(65, 105, 225, 0.2);
        }

        /* Trade Button */
        .trade-button {
            height: 80px;
            margin: 20px;
            margin-top: auto;
            background: 
                linear-gradient(135deg, rgba(205, 133, 63, 0.3), rgba(160, 100, 40, 0.2)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            border: 3px solid rgba(205, 133, 63, 0.4);
            border-radius: 15px;
            color: #DEB887;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Orbitron', monospace;
            text-shadow: 
                0 0 15px rgba(222, 184, 135, 0.6),
                2px 2px 6px rgba(0, 0, 0, 0.8);
            box-shadow: 
                0 6px 15px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }

        .trade-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(210, 105, 30, 0.4), transparent);
            transition: left 0.8s ease;
        }

        .trade-button::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), transparent 50%);
            border-radius: 12px;
            pointer-events: none;
        }

        .trade-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 12px 30px rgba(210, 105, 30, 0.5),
                0 4px 12px rgba(0, 0, 0, 0.7),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
            border-color: rgba(210, 105, 30, 0.8);
            color: #F5DEB3;
            text-shadow: 
                0 0 18px rgba(245, 222, 179, 0.8),
                2px 2px 6px rgba(0, 0, 0, 0.9);
        }

        .trade-button:hover::before {
            left: 100%;
        }

        .trade-button.disabled {
            background: 
                linear-gradient(135deg, rgba(60, 55, 50, 0.4), rgba(40, 36, 32, 0.3)),
                linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, transparent 100%);
            border-color: rgba(105, 105, 105, 0.4);
            color: #888;
            cursor: not-allowed;
            text-shadow: 0 0 5px rgba(136, 136, 136, 0.3);
        }

        .trade-button.disabled:hover {
            transform: none;
            box-shadow: 
                0 6px 15px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            border-color: rgba(105, 105, 105, 0.4);
            color: #888;
        }

        .offering-card.food .card-button:hover {
            border-color: #DC143C;
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.3);
        }

        .offering-card.research .card-button:hover {
            border-color: #4169E1;
            box-shadow: 0 10px 30px rgba(65, 105, 225, 0.3);
        }

        /* Selected State */
        .offering-card.selected {
            transform: scale(1.1);
            z-index: 10;
            animation: selectedPulse 1s ease-in-out infinite;
        }

        .offering-card.selected .card-button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border-color: #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        @keyframes selectedPulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            }
            50% { 
                box-shadow: 0 0 50px rgba(255, 215, 0, 0.9);
            }
        }

        /* Dimmed State */
        .offering-card.dimmed {
            opacity: 0.3;
            transform: scale(0.95);
        }



        /* Tooltip */
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .traveler-modal-overlay {
                padding: 20px;
            }

            .trades-container {
                gap: 20px;
            }

            .trade-card {
                width: 320px;
                height: 480px;
            }
        }

        @media (max-width: 1024px) {
            .traveler-modal-overlay {
                padding: 15px;
            }

            .trades-container {
                flex-direction: column;
                gap: 15px;
                overflow-y: auto;
                padding: 15px 0;
            }

            .trade-card {
                width: 300px;
                height: 450px;
            }

            .traveler-header {
                padding: 20px 50px 15px 20px;
            }

            .merchant-timer {
                right: 60px;
                top: 15px;
                min-width: 180px;
            }

            .timer-bar-container {
                width: 140px;
            }

            .traveler-title {
                font-size: 36px;
            }

            .traveler-subtitle {
                font-size: 18px;
            }
        }

        @media (max-width: 768px) {
            .traveler-modal-overlay {
                padding: 10px;
            }

            .traveler-title {
                font-size: 28px;
                letter-spacing: 1px;
            }

            .traveler-subtitle {
                font-size: 16px;
            }

            .trade-card {
                width: 280px;
                height: 420px;
            }

            .cost-section, .benefit-section {
                height: 110px;
            }

            .cost-amount, .benefit-amount {
                font-size: 24px;
            }

            .cost-label, .benefit-label {
                font-size: 12px;
            }

            .exchange-arrow {
                height: 50px;
            }

            .arrow-icon {
                font-size: 28px;
            }

            .trade-category {
                height: 50px;
            }

            .category-badge {
                font-size: 12px;
                padding: 8px 14px;
            }

            .trade-button {
                font-size: 14px;
                height: 65px;
                margin: 15px;
            }

            .resource-display {
                gap: 8px;
                flex-wrap: wrap;
            }

            .resource-item-display {
                padding: 5px 10px;
                font-size: 12px;
            }

            .merchant-timer {
                right: 15px;
                top: 10px;
                min-width: 140px;
                padding: 8px 12px;
            }

            .timer-label {
                font-size: 10px;
            }

            .timer-display {
                font-size: 14px;
            }

            .timer-bar-container {
                width: 120px;
                height: 3px;
            }
        }

        @media (max-width: 480px) {
            .traveler-modal {
                border-radius: 10px;
            }

            .traveler-header {
                padding: 20px 40px 20px 20px;
            }

            .traveler-title {
                font-size: 28px;
            }

            .trade-card {
                width: 260px;
                height: 420px;
            }

            .cost-section, .benefit-section {
                height: 110px;
            }

            .exchange-arrow {
                height: 50px;
            }

            .trade-category {
                height: 50px;
            }

            .timer-display {
                font-size: 18px;
            }
        }

        /* Particles Effect */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #D2691E;
            border-radius: 50%;
            opacity: 0;
            animation: particleFloat 3s ease-in-out infinite;
        }

        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: translateY(100px) scale(0);
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="game-background"></div>

    <!-- Traveler's Trade Modal -->
    <div class="traveler-modal-overlay" id="travelerModal">
        <div class="traveler-modal">
            <!-- Particles Effect -->
            <div class="particles" id="particles"></div>

            <!-- Close Button -->
            <button class="close-button" id="closeButton">
                <i class="fas fa-times"></i>
            </button>

            <!-- Merchant Timer (Top Right) -->
            <div class="merchant-timer">
                <div class="timer-label">Merchant Leaves In</div>
                <div class="timer-display" id="merchantTimer">1 day</div>
                <div class="timer-bar-container">
                    <div class="timer-bar" id="merchantTimerBar"></div>
                </div>
            </div>

            <!-- Header Section -->
            <div class="traveler-header">
                <h1 class="traveler-title">
                    <i class="fas fa-store"></i>
                    Traveler's Trade Caravan
                </h1>
                <p class="traveler-subtitle">Welcome, survivor! I have goods to trade...</p>
                
                <!-- Current Resources Display -->
                <div class="resource-display">
                    <div class="resource-item-display resource">
                        <i class="fas fa-cog resource-icon"></i>
                        <span class="resource-value" id="currentResource">245</span>
                    </div>
                    <div class="resource-item-display ammunition">
                        <i class="fas fa-crosshairs resource-icon"></i>
                        <span class="resource-value" id="currentAmmo">78</span>
                    </div>
                    <div class="resource-item-display food">
                        <i class="fas fa-apple-alt resource-icon"></i>
                        <span class="resource-value" id="currentFood">52</span>
                    </div>
                    <div class="resource-item-display research">
                        <i class="fas fa-flask resource-icon"></i>
                        <span class="resource-value" id="currentResearch">19</span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="traveler-content">
                <!-- Trade Cards -->
                <div class="trades-container" id="tradesContainer">
                    <!-- Trade 1: -100 Resource → +200 Ammunition -->
                    <div class="trade-card affordable" data-cost-type="resource" data-cost-amount="100" data-benefit-type="ammunition" data-benefit-amount="200">
                        <div class="cost-section">
                            <div class="cost-label">Give</div>
                            <div class="cost-amount">
                                <i class="fas fa-cog cost-icon"></i>
                                -100 Resource
                            </div>
                        </div>
                        <div class="exchange-arrow">
                            <i class="fas fa-arrow-down arrow-icon"></i>
                        </div>
                        <div class="benefit-section">
                            <div class="benefit-label">Get</div>
                            <div class="benefit-amount">
                                <i class="fas fa-crosshairs benefit-icon"></i>
                                +200 Ammunition
                            </div>
                        </div>
                        <div class="trade-category">
                            <div class="category-badge profit" data-tooltip="Favorable exchange rate - good value for your resources">
                                <i class="fas fa-chart-line"></i>
                                Profit
                            </div>
                        </div>
                        <button class="trade-button">
                            Make This Trade
                        </button>
                    </div>

                    <!-- Trade 2: -20 Research → +400 Resource -->
                    <div class="trade-card affordable" data-cost-type="research" data-cost-amount="20" data-benefit-type="resource" data-benefit-amount="400">
                        <div class="cost-section">
                            <div class="cost-label">Give</div>
                            <div class="cost-amount">
                                <i class="fas fa-flask cost-icon"></i>
                                -20 Research
                            </div>
                        </div>
                        <div class="exchange-arrow">
                            <i class="fas fa-arrow-down arrow-icon"></i>
                        </div>
                        <div class="benefit-section">
                            <div class="benefit-label">Get</div>
                            <div class="benefit-amount">
                                <i class="fas fa-cog benefit-icon"></i>
                                +400 Resource
                            </div>
                        </div>
                        <div class="trade-category">
                            <div class="category-badge bulk" data-tooltip="Large quantity trade - significant resource shift">
                                <i class="fas fa-boxes"></i>
                                Bulk
                            </div>
                        </div>
                        <button class="trade-button">
                            Make This Trade
                        </button>
                    </div>

                    <!-- Trade 3: -500 Resource → +100 Research -->
                    <div class="trade-card unaffordable" data-cost-type="resource" data-cost-amount="500" data-benefit-type="research" data-benefit-amount="100">
                        <div class="cost-section">
                            <div class="cost-label">Give</div>
                            <div class="cost-amount">
                                <i class="fas fa-cog cost-icon"></i>
                                -500 Resource
                            </div>
                        </div>
                        <div class="exchange-arrow">
                            <i class="fas fa-arrow-down arrow-icon"></i>
                        </div>
                        <div class="benefit-section">
                            <div class="benefit-label">Get</div>
                            <div class="benefit-amount">
                                <i class="fas fa-flask benefit-icon"></i>
                                +100 Research
                            </div>
                        </div>
                        <div class="trade-category">
                            <div class="category-badge growth" data-tooltip="Long-term investment - sacrifice immediate for future gain">
                                <i class="fas fa-seedling"></i>
                                Growth
                            </div>
                        </div>
                        <button class="trade-button disabled">
                            Insufficient Resources
                        </button>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        class TradingSystem {
            constructor() {
                this.selectedCard = null;
                this.currentResources = {
                    resource: 245,
                    ammunition: 78,
                    food: 52,
                    research: 19
                };
                
                // Merchant timer (2 days = 172800 seconds)
                this.merchantTimeLeft = 172800 - 86400; // 1 day remaining
                this.timerInterval = null;
                
                this.init();
                this.updateResourceDisplay();
                this.checkAffordability();
                this.startMerchantTimer();
                this.createParticles();
            }

            init() {
                // Add event listeners to cards
                document.querySelectorAll('.trade-card').forEach(card => {
                    card.addEventListener('click', () => this.selectCard(card));
                    
                    // Add hover effects for tooltips
                    const badge = card.querySelector('.category-badge');
                    if (badge) {
                        badge.addEventListener('mouseenter', (e) => this.showTooltip(e, badge.dataset.tooltip));
                        badge.addEventListener('mouseleave', () => this.hideTooltip());
                    }
                });

                // Close button
                document.getElementById('closeButton').addEventListener('click', () => {
                    this.closeModal();
                });

                // Allow closing modal with ESC (no pressure needed for trading)
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                    }
                });
            }

            updateResourceDisplay() {
                document.getElementById('currentResource').textContent = this.currentResources.resource;
                document.getElementById('currentAmmo').textContent = this.currentResources.ammunition;
                document.getElementById('currentFood').textContent = this.currentResources.food;
                document.getElementById('currentResearch').textContent = this.currentResources.research;
            }

            checkAffordability() {
                document.querySelectorAll('.trade-card').forEach(card => {
                    const costType = card.dataset.costType;
                    const costAmount = parseInt(card.dataset.costAmount);
                    
                    if (this.currentResources[costType] >= costAmount) {
                        card.classList.remove('unaffordable');
                        card.classList.add('affordable');
                        const button = card.querySelector('.trade-button');
                        button.textContent = 'Make This Trade';
                        button.classList.remove('disabled');
                    } else {
                        card.classList.remove('affordable');
                        card.classList.add('unaffordable');
                        const button = card.querySelector('.trade-button');
                        button.textContent = 'Insufficient Resources';
                        button.classList.add('disabled');
                    }
                });
            }

            selectCard(card) {
                if (this.selectedCard) return; // Already selected
                if (card.classList.contains('unaffordable')) return; // Cannot afford

                this.selectedCard = card;
                
                // Show confirmation dialog
                this.showTradeConfirmation(card);
            }

            showTradeConfirmation(card) {
                const costType = card.dataset.costType;
                const costAmount = parseInt(card.dataset.costAmount);
                const benefitType = card.dataset.benefitType;
                const benefitAmount = parseInt(card.dataset.benefitAmount);
                
                const confirmation = confirm(
                    `Confirm Trade:\n\n` +
                    `Give: ${costAmount} ${costType.charAt(0).toUpperCase() + costType.slice(1)}\n` +
                    `Get: ${benefitAmount} ${benefitType.charAt(0).toUpperCase() + benefitType.slice(1)}\n\n` +
                    `Do you want to make this trade?`
                );
                
                if (confirmation) {
                    this.executeTrade(costType, costAmount, benefitType, benefitAmount);
                } else {
                    this.selectedCard = null;
                }
            }

            executeTrade(costType, costAmount, benefitType, benefitAmount) {
                // Deduct cost
                this.currentResources[costType] -= costAmount;
                
                // Add benefit
                this.currentResources[benefitType] += benefitAmount;
                
                // Update display
                this.updateResourceDisplay();
                this.checkAffordability();
                
                // Show trade effect
                this.createTradeEffect(costType, costAmount, benefitType, benefitAmount);
                
                // Close modal after effect
                setTimeout(() => {
                    this.closeModal();
                }, 2000);
            }

            createTradeEffect(costType, costAmount, benefitType, benefitAmount) {
                // Create floating text effect for the trade
                const effect = document.createElement('div');
                effect.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 32px;
                    font-weight: bold;
                    color: #D2691E;
                    text-shadow: 0 0 20px #D2691E;
                    pointer-events: none;
                    z-index: 10000;
                    animation: tradeFloat 2s ease-out forwards;
                    text-align: center;
                `;
                effect.innerHTML = `
                    <div style="color: #FF4757; margin-bottom: 10px;">-${costAmount} ${costType.toUpperCase()}</div>
                    <div style="color: #FFA500; margin-bottom: 10px;">⇓</div>
                    <div style="color: #2ED573;">+${benefitAmount} ${benefitType.toUpperCase()}</div>
                `;
                document.body.appendChild(effect);

                // Add animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes tradeFloat {
                        0% { 
                            opacity: 0; 
                            transform: translate(-50%, -50%) scale(0.5); 
                        }
                        20% { 
                            opacity: 1; 
                            transform: translate(-50%, -50%) scale(1.1); 
                        }
                        100% { 
                            opacity: 0; 
                            transform: translate(-50%, -100px) scale(1); 
                        }
                    }
                `;
                document.head.appendChild(style);

                // Clean up
                setTimeout(() => {
                    document.body.removeChild(effect);
                    document.head.removeChild(style);
                }, 2000);
            }

            startMerchantTimer() {
                this.updateMerchantTimer();
                
                this.timerInterval = setInterval(() => {
                    this.merchantTimeLeft--;
                    this.updateMerchantTimer();
                    
                    if (this.merchantTimeLeft <= 0) {
                        this.merchantLeaves();
                    }
                }, 1000);
            }

            updateMerchantTimer() {
                const days = Math.floor(this.merchantTimeLeft / 86400);
                const hours = Math.floor((this.merchantTimeLeft % 86400) / 3600);
                
                let display;
                if (days > 0) {
                    display = `${days} day${days > 1 ? 's' : ''}`;
                    if (hours > 0) {
                        display += ` ${hours}h`;
                    }
                } else if (hours > 0) {
                    const minutes = Math.floor((this.merchantTimeLeft % 3600) / 60);
                    display = `${hours}h ${minutes}m`;
                } else {
                    const minutes = Math.floor(this.merchantTimeLeft / 60);
                    display = `${minutes}m`;
                }
                
                document.getElementById('merchantTimer').textContent = display;
                
                // Update timer bar (percentage of 2 days)
                const percentage = (this.merchantTimeLeft / 172800) * 100;
                const timerBar = document.getElementById('merchantTimerBar');
                timerBar.style.width = `${Math.max(0, percentage)}%`;
                
                // Change color as time runs low
                if (percentage < 25) {
                    timerBar.style.background = 'linear-gradient(90deg, #FF4757, #FF3742)';
                    timerBar.style.boxShadow = '0 0 15px rgba(255, 71, 87, 0.8)';
                } else if (percentage < 50) {
                    timerBar.style.background = 'linear-gradient(90deg, #FFA726, #FF9800)';
                    timerBar.style.boxShadow = '0 0 10px rgba(255, 167, 38, 0.6)';
                }
            }

            merchantLeaves() {
                clearInterval(this.timerInterval);
                
                // Show merchant leaving animation
                const leavingMessage = document.createElement('div');
                leavingMessage.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(139, 0, 0, 0.95);
                    color: #FFB6C1;
                    padding: 30px 50px;
                    border-radius: 15px;
                    font-size: 28px;
                    font-weight: bold;
                    z-index: 10000;
                    text-align: center;
                    border: 3px solid #DC143C;
                    box-shadow: 0 0 50px rgba(220, 20, 60, 0.6);
                `;
                leavingMessage.innerHTML = `
                    <div>🚐 Merchant Departed!</div>
                    <div style="font-size: 18px; margin-top: 10px;">Come back tomorrow for new trades...</div>
                `;
                document.body.appendChild(leavingMessage);
                
                setTimeout(() => {
                    document.body.removeChild(leavingMessage);
                    this.closeModal();
                }, 3000);
            }

            showTooltip(event, text) {
                const tooltip = document.getElementById('tooltip');
                tooltip.textContent = text;
                tooltip.classList.add('show');
                
                // Position tooltip
                const rect = event.target.getBoundingClientRect();
                tooltip.style.left = rect.left + rect.width / 2 + 'px';
                tooltip.style.top = rect.top - 10 + 'px';
            }

            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }

            createParticles() {
                const particlesContainer = document.getElementById('particles');
                
                setInterval(() => {
                    if (Math.random() < 0.3) { // 30% chance each interval
                        const particle = document.createElement('div');
                        particle.classList.add('particle');
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 2 + 's';
                        particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                        
                        particlesContainer.appendChild(particle);
                        
                        // Remove particle after animation
                        setTimeout(() => {
                            if (particlesContainer.contains(particle)) {
                                particlesContainer.removeChild(particle);
                            }
                        }, 4000);
                    }
                }, 500);
            }

            closeModal() {
                // Here you would return to the main game
                console.log('Closing traveler modal...');
                
                // For demo purposes, we'll just fade out
                document.getElementById('travelerModal').style.animation = 'fadeIn 0.5s ease-out reverse';
                
                setTimeout(() => {
                    // In a real implementation, this would integrate with the game's UI system
                    // window.location.href = 'game.html';
                    console.log('Returned to main game');
                }, 500);
            }

            // Static method to trigger the trading system
            static trigger() {
                // Initialize the system
                new TradingSystem();
            }
        }

        // Initialize the trading system when page loads
        document.addEventListener('DOMContentLoaded', () => {
            TradingSystem.trigger();
        });

        // Example of how to integrate with main game:
        // window.showOfferings = (day) => {
        //     // Show the offerings modal
        //     document.getElementById('offeringsModal').style.display = 'flex';
        //     OfferingsSystem.trigger(day);
        // };
    </script>
</body>
</html> 
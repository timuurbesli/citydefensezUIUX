<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Defense Z - UI/UX Mockup</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        /* NPC Recruitment Button */
        .npc-recruit-button {
            position: absolute;
            top: 10%;
            left: 38%;
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.2), rgba(0, 200, 200, 0.1));
            border: 3px solid #00ffff;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            z-index: 500;
        }

        .npc-recruit-button:hover {
            transform: scale(1.1);
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.4), rgba(0, 200, 200, 0.2));
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
        }

        .recruit-overlay {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #00ffff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .recruit-overlay i {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .recruit-overlay span {
            font-size: 10px;
            letter-spacing: 1px;
        }

        /* 3-Day Offerings Button */
        .offerings-button {
            position: absolute;
            top: 20%;
            right: 5%;
            transform: translateY(-50%);
            width: 95px;
            height: 95px;
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.7));
            border: 3px solid #ffd700;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.7), 
                        inset 0 2px 15px rgba(255, 255, 100, 0.4);
            z-index: 500;
            animation: offeringsPulse 4s ease-in-out infinite;
        }

        .offerings-button:hover {
            transform: translateY(-50%) scale(1.2);
            background: linear-gradient(145deg, rgba(255, 215, 0, 1), rgba(255, 140, 0, 0.9));
            border-color: #ffdd44;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.9), 
                        0 0 80px rgba(255, 215, 0, 0.5),
                        inset 0 2px 20px rgba(255, 255, 100, 0.6);
            animation: none;
        }

        @keyframes offeringsPulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.7), 
                            inset 0 2px 15px rgba(255, 255, 100, 0.4);
                transform: translateY(-50%) scale(1);
            }
            50% { 
                box-shadow: 0 0 45px rgba(255, 215, 0, 0.9), 
                            0 0 70px rgba(255, 215, 0, 0.4),
                            inset 0 2px 20px rgba(255, 255, 100, 0.5);
                transform: translateY(-50%) scale(1.05);
            }
        }

        .offerings-overlay {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 215, 0, 1), 
                         0 0 25px rgba(255, 215, 0, 0.7),
                         0 2px 6px rgba(0, 0, 0, 0.9);
        }

        .offerings-overlay i {
            font-size: 36px;
            margin-bottom: 6px;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(255, 215, 0, 1), 
                         0 0 30px rgba(255, 215, 0, 0.6),
                         0 2px 8px rgba(0, 0, 0, 0.9);
        }

        .offerings-overlay span {
            font-size: 11px;
            letter-spacing: 1px;
            color: #ffffff;
            text-shadow: 0 0 12px rgba(255, 215, 0, 0.9), 
                         0 2px 4px rgba(0, 0, 0, 0.9);
        }

        /* Expedition Planning Button */
        .expedition-planning-button {
            position: absolute;
            top: 50%;
            right: 5%;
            transform: translateY(-50%);
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, rgba(255, 140, 66, 0.8), rgba(255, 100, 0, 0.6));
            border: 3px solid #ff8c42;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 25px rgba(255, 140, 66, 0.6), 
                        inset 0 2px 10px rgba(255, 200, 100, 0.3);
            z-index: 500;
            animation: expeditionPulse 3s ease-in-out infinite;
        }

        .expedition-planning-button:hover {
            transform: translateY(-50%) scale(1.15);
            background: linear-gradient(145deg, rgba(255, 140, 66, 0.95), rgba(255, 100, 0, 0.8));
            border-color: #ffaa44;
            box-shadow: 0 0 40px rgba(255, 140, 66, 0.8), 
                        0 0 60px rgba(255, 140, 66, 0.4),
                        inset 0 2px 15px rgba(255, 200, 100, 0.5);
            animation: none;
        }

        @keyframes expeditionPulse {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(255, 140, 66, 0.6), 
                            inset 0 2px 10px rgba(255, 200, 100, 0.3);
            }
            50% { 
                box-shadow: 0 0 35px rgba(255, 140, 66, 0.8), 
                            0 0 50px rgba(255, 140, 66, 0.3),
                            inset 0 2px 15px rgba(255, 200, 100, 0.4);
            }
        }

        .expedition-overlay {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 12px rgba(255, 140, 66, 0.9), 
                         0 0 20px rgba(255, 140, 66, 0.6),
                         0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .expedition-overlay i {
            font-size: 32px;
            margin-bottom: 4px;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(255, 140, 66, 0.9), 
                         0 0 25px rgba(255, 140, 66, 0.5),
                         0 2px 6px rgba(0, 0, 0, 0.8);
        }

        .expedition-overlay span {
            font-size: 11px;
            letter-spacing: 1px;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 140, 66, 0.8), 
                         0 2px 3px rgba(0, 0, 0, 0.8);
        }

        /* Boosters Button */
        .boosters-button {
            position: absolute;
            top: 35%;
            right: 5%;
            transform: translateY(-50%);
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.8), rgba(255, 193, 7, 0.6));
            border: 3px solid #ffd700;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.6), 
                        inset 0 2px 10px rgba(255, 255, 100, 0.3);
            z-index: 500;
            animation: boostersPulse 3s ease-in-out infinite;
        }

        .boosters-button:hover {
            transform: translateY(-50%) scale(1.15);
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.95), rgba(255, 193, 7, 0.8));
            border-color: #ffdd44;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 
                        0 0 60px rgba(255, 215, 0, 0.4),
                        inset 0 2px 15px rgba(255, 255, 100, 0.5);
            animation: none;
        }

        @keyframes boostersPulse {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.6), 
                            inset 0 2px 10px rgba(255, 255, 100, 0.3);
            }
            50% { 
                box-shadow: 0 0 35px rgba(255, 215, 0, 0.8), 
                            0 0 50px rgba(255, 215, 0, 0.3),
                            inset 0 2px 15px rgba(255, 255, 100, 0.4);
            }
        }

        .boosters-overlay {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 12px rgba(255, 215, 0, 0.9), 
                         0 0 20px rgba(255, 215, 0, 0.6),
                         0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .boosters-overlay i {
            font-size: 32px;
            margin-bottom: 4px;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.9), 
                         0 0 25px rgba(255, 215, 0, 0.5),
                         0 2px 6px rgba(0, 0, 0, 0.8);
        }

        .boosters-overlay span {
            font-size: 11px;
            letter-spacing: 1px;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8), 
                         0 2px 3px rgba(0, 0, 0, 0.8);
        }

        .boosters-button .expand-icon {
            position: absolute;
            top: 50%;
            left: -15px;
            transform: translateY(-50%);
            font-size: 16px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            transition: all 0.3s ease;
        }

        .boosters-button.expanded .expand-icon {
            transform: translateY(-50%) rotate(180deg);
        }

        /* Boosters Drawer */
        .boosters-drawer {
            position: absolute;
            top: 0;
            right: 110px;
            width: 0;
            height: auto;
            background: linear-gradient(145deg, rgba(20,25,35,0.95), rgba(10,15,20,0.95));
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            opacity: 0;
            visibility: hidden;
        }

        .boosters-drawer.expanded {
            width: 400px;
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
            opacity: 1;
            visibility: visible;
            overflow: visible;
        }

        .drawer-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .drawer-title {
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .boosters-list {
            padding: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: flex-start;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease 0.1s, visibility 0.3s ease 0.1s;
        }

        .boosters-drawer.expanded .boosters-list {
            opacity: 1;
            visibility: visible;
        }

        .booster-item {
            position: relative;
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.3), rgba(255, 193, 7, 0.2));
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .booster-item:hover {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.5), rgba(255, 193, 7, 0.4));
            border-color: rgba(255, 215, 0, 0.8);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .booster-item i {
            font-size: 24px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .booster-count-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: linear-gradient(145deg, rgba(255, 68, 68, 0.9), rgba(255, 0, 0, 0.7));
            border: 2px solid #ff4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', monospace;
            font-size: 10px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }

        .booster-tooltip {
            position: fixed;
            bottom: auto;
            top: auto;
            left: auto;
            right: auto;
            transform: none;
            background: linear-gradient(145deg, rgba(20,25,35,0.98), rgba(10,15,20,0.98));
            border: 2px solid rgba(255, 215, 0, 0.8);
            border-radius: 8px;
            padding: 0.75rem;
            min-width: 200px;
            max-width: 280px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            z-index: 9999;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5), 0 0 50px rgba(255, 215, 0, 0.2);
            pointer-events: none;
        }

        .booster-item:hover .booster-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .booster-tooltip-title {
            font-family: 'Orbitron', monospace;
            font-size: 13px;
            font-weight: 700;
            color: #ffd700;
            margin-bottom: 0.4rem;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        .booster-tooltip-description {
            font-size: 11px;
            color: #ffffff;
            line-height: 1.3;
            margin-bottom: 0.4rem;
        }

        .booster-tooltip-type {
            font-size: 10px;
            color: #cccccc;
            font-style: italic;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Global Tooltip Specific Styles */
        .booster-tooltip.global-tooltip {
            position: fixed !important;
            z-index: 10000 !important;
            display: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            white-space: nowrap;
        }

        .booster-tooltip.global-tooltip.show {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* AOE Targeting Overlay */
        .aoe-targeting-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1000;
            cursor: crosshair;
            display: none;
        }

        .aoe-circle {
            position: absolute;
            border: 3px solid #ffd700;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.2);
            pointer-events: none;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: aoeGlow 1s ease-in-out infinite alternate;
        }

        @keyframes aoeGlow {
            from { 
                border-color: #ffd700;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            }
            to { 
                border-color: #ffff00;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            }
        }

        /* Booster Confirmation Modal */
        .booster-confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            backdrop-filter: blur(5px);
        }

        .confirmation-box {
            background: linear-gradient(145deg, rgba(20,25,35,0.95), rgba(10,15,20,0.95));
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 15px;
            padding: 2rem;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .confirmation-icon {
            font-size: 48px;
            color: #ffd700;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .confirmation-title {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .confirmation-message {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 2rem;
            line-height: 1.4;
        }

        .confirmation-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirmation-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid;
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .confirmation-btn.yes {
            background: linear-gradient(145deg, rgba(0, 255, 128, 0.2), rgba(0, 200, 100, 0.1));
            border-color: #00ff80;
            color: #ffffff;
        }

        .confirmation-btn.yes:hover {
            background: linear-gradient(145deg, rgba(0, 255, 128, 0.4), rgba(0, 200, 100, 0.2));
            box-shadow: 0 0 20px rgba(0, 255, 128, 0.3);
            transform: translateY(-2px);
        }

        .confirmation-btn.no {
            background: linear-gradient(145deg, rgba(255, 68, 68, 0.2), rgba(255, 0, 0, 0.1));
            border-color: #ff4444;
            color: #ffffff;
        }

        .confirmation-btn.no:hover {
            background: linear-gradient(145deg, rgba(255, 68, 68, 0.4), rgba(255, 0, 0, 0.2));
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, rgba(20,25,35,0.95), rgba(10,15,20,0.95));
            border: 2px solid;
            border-radius: 10px;
            padding: 1rem 1.5rem;
            min-width: 300px;
            z-index: 1200;
            backdrop-filter: blur(10px);
            transform: translateX(100%);
            transition: all 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: #00ff80;
            box-shadow: 0 0 20px rgba(0, 255, 128, 0.3);
        }

        .notification.warning {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification.success .notification-icon {
            color: #00ff80;
        }

        .notification.warning .notification-icon {
            color: #ffd700;
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.2rem;
        }

        .notification-message {
            font-size: 12px;
            color: #cccccc;
        }



        /* Effects Panel Simple Styles */
        .effects-panel-simple {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }

        .effect-icon-simple {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 2px solid;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(3px);
        }

        .effect-icon-simple.buff {
            border-color: #00ff80;
            box-shadow: 0 0 8px rgba(0,255,128,0.4);
        }

        .effect-icon-simple.debuff {
            border-color: #ff4444;
            box-shadow: 0 0 8px rgba(255,68,68,0.4);
        }

        .effect-icon-simple:hover {
            transform: scale(1.1);
        }

        .effect-icon-simple.buff:hover {
            box-shadow: 0 0 15px rgba(0,255,128,0.7);
        }

        .effect-icon-simple.debuff:hover {
            box-shadow: 0 0 15px rgba(255,68,68,0.7);
        }

        .effect-icon-simple i {
            font-size: 16px;
        }

        .effect-icon-simple.buff i {
            color: #00ff80;
        }

        .effect-icon-simple.debuff i {
            color: #ff4444;
        }

        .effect-tooltip-simple {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(145deg, rgba(20,25,35,0.95), rgba(10,15,20,0.95));
            border: 2px solid;
            border-radius: 8px;
            padding: 0.75rem;
            min-width: 180px;
            max-width: 250px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 200;
            backdrop-filter: blur(10px);
            pointer-events: none;
        }

        .effect-icon-simple:hover .effect-tooltip-simple {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(5px);
        }

        .effect-icon-simple.buff .effect-tooltip-simple {
            border-color: #00ff80;
            box-shadow: 0 0 15px rgba(0,255,128,0.3);
        }

        .effect-icon-simple.debuff .effect-tooltip-simple {
            border-color: #ff4444;
            box-shadow: 0 0 15px rgba(255,68,68,0.3);
        }

        .tooltip-title-simple {
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 0.4rem;
        }

        .effect-icon-simple.buff .tooltip-title-simple {
            color: #00ff80;
        }

        .effect-icon-simple.debuff .tooltip-title-simple {
            color: #ff4444;
        }

        .tooltip-description-simple {
            font-size: 11px;
            color: #ffffff;
            margin-bottom: 0.4rem;
            line-height: 1.3;
        }

        .tooltip-source-simple {
            font-size: 10px;
            color: #aaaaaa;
            font-style: italic;
            margin-bottom: 0.4rem;
        }

        .tooltip-value-simple {
            font-family: 'Orbitron', monospace;
            font-size: 11px;
            font-weight: 700;
            text-align: center;
            padding: 0.2rem;
            border-radius: 3px;
            background: rgba(0,0,0,0.3);
        }

        .effect-icon-simple.buff .tooltip-value-simple {
            color: #00ff80;
            border: 1px solid rgba(0,255,128,0.3);
        }

        .effect-icon-simple.debuff .tooltip-value-simple {
            color: #ff4444;
            border: 1px solid rgba(255,68,68,0.3);
        }

        /* Expedition Planning Modal Styles */
        .expedition-planning-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(0,15,25,0.75), rgba(5,20,15,0.75));
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.8s ease-out;
        }

        .expedition-iframe-container {
            position: relative;
            width: 95vw;
            height: 90vh;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .expedition-iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 15px;
        }



        /* NPC Selection Modal Styles */
        .npc-selection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(0,15,25,0.75), rgba(5,20,15,0.75));
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.8s ease-out;
        }

        .selection-iframe-container {
            position: relative;
            width: 95vw;
            height: 90vh;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .selection-iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 15px;
        }

        .close-modal-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .close-modal-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .background-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0,150,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255,100,0,0.1) 0%, transparent 50%),
                linear-gradient(45deg, transparent 48%, rgba(0,255,150,0.02) 49%, rgba(0,255,150,0.02) 51%, transparent 52%);
            animation: staticNoise 2s infinite;
        }

        .selection-container {
            position: relative;
            width: 90%;
            max-width: 1400px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideIn 1s ease-out 0.3s both;
        }

        .selection-header {
            text-align: center;
            margin-bottom: 3rem;
            color: #ffffff;
        }

        .main-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: 3px;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(0,255,150,0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .context-info {
            font-size: 1.2rem;
            color: #00ff96;
            font-weight: 400;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .cards-container {
            display: flex;
            gap: 150px;
            justify-content: center;
            align-items: stretch;
            flex: 1;
        }

        .npc-card {
            width: 600px;
            height: 700px;
            background: linear-gradient(145deg, rgba(20,25,35,0.9), rgba(10,15,20,0.9));
            border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: cardFlicker 1.5s ease-out;
        }

        .npc-card:hover {
            transform: translateY(-10px);
            border-color: var(--faction-color);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5), 0 0 30px var(--faction-glow);
        }

        .npc-card.research {
            --faction-color: #0080ff;
            --faction-glow: rgba(0,128,255,0.3);
        }

        .npc-card.military {
            --faction-color: #00ff80;
            --faction-glow: rgba(0,255,128,0.3);
        }

        .card-header {
            background: var(--faction-color);
            color: white;
            padding: 1rem;
            text-align: center;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            position: relative;
        }

        .division-name {
            font-size: 1.1rem;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        .role-title {
            font-size: 0.9rem;
            opacity: 0.9;
            letter-spacing: 1px;
        }

        .faction-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
        }

        .portrait-section {
            height: 300px;
            background: linear-gradient(135deg, rgba(50,60,80,0.3), rgba(30,40,50,0.3));
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .character-portrait {
            width: 280px;
            height: 280px;
            background: var(--faction-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
            font-weight: bold;
            overflow: hidden;
            border: 4px solid var(--faction-color);
            box-shadow: 0 0 20px var(--faction-glow);
        }

        .character-portrait img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .character-portrait .fallback-text {
            position: absolute;
            display: none;
        }

        .character-info {
            padding: 1.5rem;
            color: white;
        }

        .character-name {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--faction-color);
        }

        .character-role {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-bottom: 1.5rem;
        }

        .character-quote {
            font-style: italic;
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-left: 3px solid var(--faction-color);
            border-radius: 0 5px 5px 0;
            position: relative;
        }

        .character-quote::before {
            content: '"';
            font-size: 2rem;
            position: absolute;
            left: 0.5rem;
            top: 0.2rem;
            color: var(--faction-color);
        }

        .benefits-section {
            margin-bottom: 2rem;
        }

        .benefits-title {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            color: #ffffff;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .benefit-icon {
            color: #00ff96;
            margin-right: 0.8rem;
            font-weight: bold;
        }

        .select-button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--faction-color), rgba(255,255,255,0.1));
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .select-button:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), var(--faction-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .cancel-button {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.7);
            padding: 0.8rem 2rem;
            border-radius: 25px;
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cancel-button:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(50px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes cardFlicker {
            0% { opacity: 0; transform: translateX(-20px); }
            10% { opacity: 0.3; }
            20% { opacity: 0.1; }
            30% { opacity: 0.8; }
            40% { opacity: 0.3; }
            50% { opacity: 1; transform: translateX(0); }
            100% { opacity: 1; transform: translateX(0); }
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(0,255,150,0.5); }
            to { text-shadow: 0 0 30px rgba(0,255,150,0.8), 0 0 40px rgba(0,255,150,0.3); }
        }

        @keyframes staticNoise {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.05; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .cards-container {
                gap: 100px;
            }
            
            .npc-card {
                width: 500px;
                height: 650px;
            }
        }

        @media (max-width: 900px) {
            .cards-container {
                flex-direction: column;
                gap: 2rem;
                align-items: center;
            }
            
            .npc-card {
                width: 400px;
                height: 600px;
            }
            
            .main-title {
                font-size: 2rem;
            }
        }



        /* Expedition Summary Modal */
        .expedition-summary-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .summary-modal-content {
            background: linear-gradient(145deg, rgba(30, 35, 45, 0.95), rgba(20, 25, 35, 0.95));
            border: 2px solid rgba(34, 197, 94, 0.6);
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .summary-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 2px solid rgba(34, 197, 94, 0.3);
            background: linear-gradient(90deg, rgba(0,0,0,0.8) 0%, rgba(20,20,20,0.6) 100%);
            border-radius: 15px 15px 0 0;
        }

        .summary-modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: #22c55e;
            letter-spacing: 2px;
            margin: 0;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
        }

        .summary-modal-body {
            padding: 2rem;
            color: #ffffff;
        }

        .expedition-progress-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .progress-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .expedition-name {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: #22c55e;
            margin-bottom: 0.5rem;
        }

        .expedition-location {
            font-size: 1rem;
            color: #d1d5db;
            opacity: 0.8;
        }

        .time-remaining-display {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .time-label {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .time-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            color: #22c55e;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
        }

        .progress-bar-container {
            margin-top: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-bar .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #4ade80 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: #d1d5db;
        }

        .expedition-team-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .team-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .team-members {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .team-member {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .member-portrait {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #666, #333);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.2rem;
        }

        .member-role {
            color: #22c55e;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .expedition-stats-section {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            font-weight: 700;
            color: #22c55e;
        }

        .stat-value.risk-low {
            color: #4ade80;
        }

        .stat-value.risk-medium {
            color: #f59e0b;
        }

        .stat-value.risk-high {
            color: #ef4444;
        }

        .expedition-actions {
            text-align: center;
        }

        .recall-expedition-btn {
            padding: 0.8rem 2rem;
            background: linear-gradient(145deg, #ef4444, #dc2626);
            border: 2px solid rgba(239, 68, 68, 0.6);
            border-radius: 8px;
            color: #ffffff;
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0 auto;
        }

        .recall-expedition-btn:hover {
            background: linear-gradient(145deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .recall-expedition-btn i {
            font-size: 1.2rem;
        }

        /* Expedition Slots */
        .expedition-slots-container {
            position: absolute;
            top: calc(48% + 70px); /* 25px below the 90px button (45px radius + 25px gap) */
            right: calc(1% + 45px); /* Center the 170px container under the 90px button */
            width: 170px;
            height: 60px;
            z-index: 500;
        }

        .expedition-slot {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(145deg, rgba(60, 60, 60, 0.8), rgba(40, 40, 40, 0.6));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.4), 
                        inset 0 2px 8px rgba(255, 255, 255, 0.1);
        }

        /* Individual slot positioning for staggered arc formation */
        #expeditionSlot1 {
            left: 0;
            top: 0;
        }

        #expeditionSlot2 {
            left: 60px;
            top: 8px; /* 8px lower for the arc effect */
        }

        #expeditionSlot3 {
            right: 0;
            top: 0;
        }

        .expedition-slot:hover {
            transform: scale(1.1);
            border-color: rgba(255, 140, 66, 0.5);
            box-shadow: 0 0 20px rgba(255, 140, 66, 0.3);
        }

        .expedition-slot.active {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.8), rgba(22, 163, 74, 0.6));
            border-color: #22c55e;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
            animation: expeditionSlotPulse 2s ease-in-out infinite;
        }

        .expedition-slot.active:hover {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.8));
            border-color: #4ade80;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6);
            animation: none;
        }

        @keyframes expeditionSlotPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
            }
            50% { 
                box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
            }
        }

        .slot-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .slot-icon {
            font-size: 16px;
            margin-bottom: 2px;
            color: rgba(255, 255, 255, 0.7);
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
        }

        .expedition-slot.active .slot-icon {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
        }

        .slot-text {
            font-size: 7px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 0.5px;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
        }

        .expedition-slot.active .slot-text {
            color: #ffffff;
            text-shadow: 0 0 8px rgba(34, 197, 94, 0.8);
        }

        .expedition-slot.empty:hover .slot-icon,
        .expedition-slot.empty:hover .slot-text {
            color: rgba(255, 140, 66, 0.8);
        }

        /* Completed expedition slot styling */
        .expedition-slot.completed {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.7));
            border-color: #22c55e;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.5);
            animation: completedSlotPulse 3s ease-in-out infinite;
        }

        .expedition-slot.completed:hover {
            background: linear-gradient(145deg, rgba(34, 197, 94, 1), rgba(22, 163, 74, 0.9));
            border-color: #4ade80;
            box-shadow: 0 0 35px rgba(34, 197, 94, 0.7);
            animation: none;
        }

        @keyframes completedSlotPulse {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(34, 197, 94, 0.5);
            }
            50% { 
                box-shadow: 0 0 35px rgba(34, 197, 94, 0.7);
            }
        }

        .expedition-slot.completed .slot-icon {
            color: #ffffff;
            text-shadow: 0 0 15px rgba(34, 197, 94, 0.8);
        }

        .expedition-slot.completed .slot-text {
            color: #ffffff;
            text-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
        }

        /* Failed expedition slot styling */
        .expedition-slot.failed {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.7));
            border-color: #ef4444;
            box-shadow: 0 0 25px rgba(239, 68, 68, 0.5);
            animation: failedSlotPulse 3s ease-in-out infinite;
        }

        .expedition-slot.failed:hover {
            background: linear-gradient(145deg, rgba(239, 68, 68, 1), rgba(220, 38, 38, 0.9));
            border-color: #f87171;
            box-shadow: 0 0 35px rgba(239, 68, 68, 0.7);
            animation: none;
        }

        @keyframes failedSlotPulse {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(239, 68, 68, 0.5);
            }
            50% { 
                box-shadow: 0 0 35px rgba(239, 68, 68, 0.7);
            }
        }

        .expedition-slot.failed .slot-icon {
            color: #ffffff;
            text-shadow: 0 0 15px rgba(239, 68, 68, 0.8);
        }

        .expedition-slot.failed .slot-text {
            color: #ffffff;
            text-shadow: 0 0 12px rgba(239, 68, 68, 0.8);
        }

        /* Post-Expedition Modal Styles */
        .post-expedition-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .post-expedition-modal-content {
            background: linear-gradient(145deg, rgba(20, 25, 35, 0.95), rgba(15, 20, 30, 0.9));
            border: 2px solid rgba(34, 197, 94, 0.6);
            border-radius: 15px;
            padding: 0;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 
                        0 0 40px rgba(34, 197, 94, 0.3);
            backdrop-filter: blur(10px);
        }

        .post-expedition-modal-header {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.7));
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(34, 197, 94, 0.4);
        }

        .post-expedition-modal-title {
            color: #ffffff;
            font-size: 18px;
            font-weight: 900;
            margin: 0;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
            letter-spacing: 1px;
        }

        .post-expedition-modal-body {
            padding: 25px;
            color: #ffffff;
        }

        .expedition-result-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .expedition-success-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #22c55e;
            font-weight: 700;
            font-size: 14px;
        }

        .expedition-success-badge i {
            font-size: 20px;
            color: #22c55e;
        }

        .expedition-details h3 {
            margin: 0 0 5px 0;
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
        }

        .expedition-details .expedition-location {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .rewards-section {
            margin-bottom: 25px;
        }

        .rewards-title {
            color: #ffffff;
            font-size: 14px;
            font-weight: 700;
            margin: 0 0 15px 0;
            text-align: center;
            letter-spacing: 1px;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 3px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .resource-icon {
            font-size: 20px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 140, 66, 0.2);
            border-radius: 8px;
        }

        .resource-info {
            flex: 1;
        }

        .resource-name {
            font-size: 12px;
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .resource-amount {
            font-size: 14px;
            color: #22c55e;
            font-weight: 700;
        }

        .team-return-section {
            margin-bottom: 25px;
        }

        .team-title {
            color: #ffffff;
            font-size: 14px;
            font-weight: 700;
            margin: 0 0 15px 0;
            text-align: center;
            letter-spacing: 1px;
        }

        .returned-team-members {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .returned-team-member {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .returned-member-portrait {
            width: 35px;
            height: 35px;
            background: rgba(0, 150, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #0096ff;
        }

        .returned-member-info {
            flex: 1;
        }

        .returned-member-name {
            font-size: 12px;
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .returned-member-role {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .post-expedition-actions {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .claim-rewards-btn {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.7));
            border: 2px solid #22c55e;
            border-radius: 10px;
            color: #ffffff;
            font-size: 14px;
            font-weight: 700;
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }

        .claim-rewards-btn:hover {
            background: linear-gradient(145deg, rgba(34, 197, 94, 1), rgba(22, 163, 74, 0.9));
            border-color: #4ade80;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
            transform: translateY(-2px);
        }

        .claim-rewards-btn i {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Main Game Container -->
    <div class="game-container">
        
        <!-- Clickable Home Building Area -->
        <div class="home-building-clickable" id="home-building" title="Base Management">
            <div class="home-building-overlay">
                <i class="fas fa-tools"></i>
                <span>UPGRADES</span>
            </div>
        </div>
        
        <!-- Clickable Soldier Group NPC Area -->
        <div class="soldier-npc-clickable" id="soldier-npc" title="Soldier Management">
            <div class="npc-overlay">
                <i class="fas fa-user-shield"></i>
                <span>Talk</span>
            </div>
        </div>
        
        <!-- Clickable Farmer Group NPC Area -->
        <div class="farmer-npc-clickable" id="farmer-npc" title="Farmer Management">
            <div class="npc-overlay">
                <i class="fas fa-seedling"></i>
                <span>Talk</span>
            </div>
        </div>
        
        <!-- NPC Recruitment Plus Button -->
        <div class="npc-recruit-button" id="npc-recruit-btn" title="Recruit Specialist">
            <div class="recruit-overlay">
                <i class="fas fa-plus"></i>
                <span>RECRUIT</span>
            </div>
        </div>
        
        <!-- Top HUD Panel -->
        <div class="top-hud">
            <!-- Resource & Defense Management Panel (Top-Left) -->
            <div class="resource-panel">
                <div class="resources-section">
                    <div class="resource-item" id="resource-display">
                        <i class="fas fa-cog resource-icon"></i>
                        <span class="resource-value">245</span>
                    </div>
                    <div class="resource-item" id="ammunition-display">
                        <i class="fas fa-bomb resource-icon"></i>
                        <span class="resource-value">78</span>
                    </div>
                    <div class="resource-item" id="food-display">
                        <i class="fas fa-apple-alt resource-icon"></i>
                        <span class="resource-value">52</span>
                    </div>
                    <div class="resource-item" id="research-display">
                        <i class="fas fa-flask resource-icon"></i>
                        <span class="resource-value">19</span>
                    </div>
                    <div class="resource-item population-item" id="population-display">
                        <i class="fas fa-users resource-icon"></i>
                        <span class="resource-value">45/60</span>
                        <i class="fas fa-chevron-right expand-icon"></i>
                        
                        <!-- Defense Unit Drawer -->
                        <div class="defense-drawer" id="defense-drawer">
                    <div class="drawer-content">
                        <div class="drawer-item">
                            <i class="fas fa-user-shield drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">25</span>
                                <span class="drawer-name">Soldiers</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon"></i>
                                <span class="pop-count">25</span>
                            </div>
                        </div>
                        <div class="drawer-item">
                            <i class="fas fa-gun drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">8</span>
                                <span class="drawer-name">Machine Gun</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon"></i>
                                <span class="pop-count">8</span>
                            </div>
                        </div>
                        <div class="drawer-item">
                            <i class="fas fa-rocket drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">5</span>
                                <span class="drawer-name">Rockets</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon"></i>
                                <span class="pop-count">5</span>
                            </div>
                        </div>
                        <div class="drawer-item">
                            <i class="fas fa-mortar-pestle drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">2</span>
                                <span class="drawer-name">Mortars</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon"></i>
                                <span class="pop-count">2</span>
                            </div>
                        </div>
                        <div class="drawer-item">
                            <i class="fas fa-circle-dot drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">12</span>
                                <span class="drawer-name">Mines</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon zero-cost"></i>
                                <span class="pop-count zero-cost">0</span>
                            </div>
                        </div>
                        <div class="drawer-item">
                            <i class="fas fa-cubes drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">18</span>
                                <span class="drawer-name">Walls</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon zero-cost"></i>
                                <span class="pop-count zero-cost">0</span>
                            </div>
                        </div>
                        <div class="drawer-item">
                            <i class="fas fa-chess-rook drawer-icon"></i>
                            <div class="drawer-info">
                                <span class="drawer-count">4</span>
                                <span class="drawer-name">Outposts</span>
                            </div>
                            <div class="drawer-pop-cost">
                                <i class="fas fa-users pop-icon"></i>
                                <span class="pop-count">4</span>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
                

            </div>

            <!-- Effects Panel -->
            <div class="effects-panel-simple" id="effectsPanel">
                <!-- Effects will be populated here -->
            </div>
            
            <!-- Unified Command Panel (TOP-CENTER) -->
            <div class="unified-command-panel">
                <!-- Base Health Section -->
                <div class="command-section health-section">
                    <i class="fas fa-heart section-icon"></i>
                    <div class="health-info">
                        <div class="health-bar">
                            <div class="health-fill" style="width: 78%"></div>
                        </div>
                        <span class="health-text">78%</span>
                    </div>
                </div>
                
                <!-- Day Progress Section -->
                <div class="command-section day-section">
                    <div class="day-icon">
                        <i class="fas fa-sun" id="day-night-icon"></i>
                    </div>
                    <div class="day-counter">DAY 5</div>
                    <div class="progress-border" id="progress-border">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
                
                <!-- End Day Section -->
                <div class="command-section end-day-section">
                    <button class="end-day-btn" id="end-day-btn">
                        END DAY
                    </button>
                </div>
            </div>
            
            <!-- Game Controls & Management (Top-Right) -->
            <div class="game-controls">
                <div class="control-buttons">
                    <div class="speed-controls">
                        <button class="control-btn" id="pause-btn">
                            <i class="fas fa-pause"></i>
                        </button>
                        <button class="control-btn active" id="play-btn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" id="speed-2x-btn">
                            <i class="fas fa-forward"></i>
                            <span>2x</span>
                        </button>
                        <button class="control-btn" id="speed-3x-btn">
                            <i class="fas fa-fast-forward"></i>
                            <span>3x</span>
                        </button>
                    </div>
                    
                    <button class="settings-btn" onclick="openSettings()">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="settings-btn" onclick="testEndGame()" style="background: rgba(255, 0, 0, 0.3); border-color: #ff0000;" title="Test End Game">
                        <i class="fas fa-skull"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Bottom HUD Panel -->
        <div class="bottom-hud">
            <!-- Building Cards Panel -->
            <div class="building-cards-container">
                <div class="cards-header">
                    <div class="refresh-section">
                        <button class="refresh-cards-btn" id="refresh-cards-btn">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <div class="refresh-count" id="refresh-count">5/5</div>
                    </div>
                </div>
                <div class="building-cards">
                    <img src="../assets/cards/Factory.png" alt="Factory" class="building-card-img affordable" data-cost="150">
                    <img src="../assets/cards/House.png" alt="Barracks" class="building-card-img affordable" data-cost="120">
                    <img src="../assets/cards/Ammo.png" alt="Ammo Factory" class="building-card-img unaffordable" data-cost="400">
                </div>
            </div>
        </div>
        
        <!-- Breaking News Ticker (Fixed at bottom) -->
        <div class="breaking-news-bottom">
            <div class="news-label">BREAKING NEWS</div>
            <div class="news-ticker-bottom">
                <span class="news-text-bottom">Infection has spread to every city in USA • Military forces retreating to safe zones • Emergency broadcasts report 89% population loss • Government declares martial law in remaining territories • Survivors advised to fortify positions immediately</span>
            </div>
        </div>
        
        <!-- Defense Units Section (Bottom-Left) -->
        <div class="defense-units-section">
            <h3>Defense Units</h3>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-user-shield unit-icon"></i>
                        <span class="unit-name">Soldiers</span>
                    </div>
                    <div class="unit-controls">
                        <button class="unit-button" data-unit="soldier">
                            <span>25</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-gun unit-icon"></i>
                        <span class="unit-name">Machine Gun</span>
                    </div>
                    <div class="unit-controls">
                        <button class="plus-button" data-cost="10" data-unit="mg">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="unit-button" data-unit="mg">
                            <span>8</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-rocket unit-icon"></i>
                        <span class="unit-name">Rockets</span>
                    </div>
                    <div class="unit-controls">
                        <button class="plus-button" data-cost="25" data-unit="rocket">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="unit-button" data-unit="rocket">
                            <span>5</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-mortar-pestle unit-icon"></i>
                        <span class="unit-name">Mortars</span>
                    </div>
                    <div class="unit-controls">
                        <button class="plus-button" data-cost="30" data-unit="mortar">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="unit-button" data-unit="mortar">
                            <span>2</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-circle-dot unit-icon"></i>
                        <span class="unit-name">Mines</span>
                    </div>
                    <div class="unit-controls">
                        <button class="plus-button" data-cost="15" data-unit="mine">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="unit-button" data-unit="mine">
                            <span>12</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-cubes unit-icon"></i>
                        <span class="unit-name">Walls</span>
                    </div>
                    <div class="unit-controls">
                        <button class="plus-button" data-cost="8" data-unit="wall">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="unit-button" data-unit="wall">
                            <span>18</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="unit-row">
                <div class="unit-item">
                    <div class="unit-info">
                        <i class="fas fa-chess-rook unit-icon"></i>
                        <span class="unit-name">Outposts</span>
                    </div>
                    <div class="unit-controls">
                        <button class="plus-button" data-cost="40" data-unit="outpost">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="unit-button" data-unit="outpost">
                            <span>4</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NPC Dialogue Popup -->
        <div class="npc-dialogue-popup" id="npcDialogue">
            <!-- Character Portrait Panel -->
            <div class="character-panel">
                <div class="character-portrait">
                    <div class="character-avatar farmer-avatar" id="characterAvatar">👨‍🌾</div>
                </div>
                <div class="character-info">
                    <div class="character-name" id="characterName">Jake Morrison</div>
                    <div class="character-title" id="characterTitle">Crop Specialist</div>
                </div>
                <div class="audio-indicator">
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                </div>
            </div>

            <!-- Transmission Panel -->
            <div class="transmission-panel">
                <div class="transmission-header">
                    <div class="transmission-title">TRANSMISSION</div>
                    <div class="signal-controls">
                        <div class="signal-strength">
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                        </div>
                        <div class="audio-controls">
                            <div class="control-btn-audio">🔊</div>
                            <div class="control-btn-audio">⏸</div>
                        </div>
                    </div>
                </div>

                <div class="dialogue-content">
                    <div class="dialogue-text" id="dialogueText">
                        "Harvest is coming in strong this season, should keep the city fed for months."
                    </div>
                    
                    <div class="waveform-display">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>

                <div class="timestamp" id="timestamp">REC 07:23 :14</div>
            </div>
        </div>
        
        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>
    </div>
    
    <!-- Boosters Button -->
    <div class="boosters-button" id="boostersBtn" onclick="toggleBoostersDrawer()">
        <div class="boosters-overlay">
            <i class="fas fa-bolt"></i>
            <span>BOOSTERS</span>
        </div>
        <i class="fas fa-chevron-left expand-icon" id="boostersExpandIcon"></i>
        
        <!-- Boosters Drawer -->
        <div class="boosters-drawer" id="boostersDrawer">
            <div class="drawer-content">
                
                <div class="boosters-list" id="boostersList">
                    <!-- Boosters will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Traveler's Trade Button -->
    <div class="offerings-button" id="offeringsBtn" onclick="show3DayOfferingsModal()">
        <div class="offerings-overlay">
            <i class="fas fa-store"></i>
            <span>TRADE</span>
        </div>
    </div>

    <!-- Expedition Planning Button -->
    <div class="expedition-planning-button" id="expeditionPlanningBtn" onclick="showExpeditionPlanningModal()">
        <div class="expedition-overlay">
            <i class="fas fa-map-marked-alt"></i>
            <span>EXPEDITIONS</span>
        </div>
    </div>

    <!-- Expedition Slots -->
    <div class="expedition-slots-container">
        <div class="expedition-slot" id="expeditionSlot1" onclick="showExpeditionSlotSummary(1)">
            <div class="slot-content">
                <i class="fas fa-plus slot-icon"></i>
                <span class="slot-text">Empty</span>
            </div>
        </div>
        <div class="expedition-slot" id="expeditionSlot2" onclick="showExpeditionSlotSummary(2)">
            <div class="slot-content">
                <i class="fas fa-plus slot-icon"></i>
                <span class="slot-text">Empty</span>
            </div>
        </div>
        <div class="expedition-slot" id="expeditionSlot3" onclick="showExpeditionSlotSummary(3)">
            <div class="slot-content">
                <i class="fas fa-plus slot-icon"></i>
                <span class="slot-text">Empty</span>
            </div>
        </div>
    </div>



    
    <!-- Traveler's Trade Modal (IFrame Popup) -->
    <div class="expedition-planning-overlay" id="offeringsModal" style="display: none;">
        <div class="expedition-iframe-container">
            <iframe id="offeringsFrame" src="3day-offerings.html" frameborder="0"></iframe>
            <button class="close-modal-btn" onclick="close3DayOfferingsModal()">✕</button>
        </div>
    </div>

    <!-- Expedition Planning Modal (IFrame Popup) -->
    <div class="expedition-planning-overlay" id="expeditionPlanningModal" style="display: none;">
        <div class="expedition-iframe-container">
            <iframe id="expeditionPlanningFrame" src="expedition-planning.html" frameborder="0"></iframe>
            <button class="close-modal-btn" onclick="closeExpeditionPlanningModal()">✕</button>
        </div>
    </div>
    
    <!-- NPC Selection Modal (IFrame Popup) -->
    <div class="npc-selection-overlay" id="npcSelectionModal" style="display: none;">
        <div class="selection-iframe-container">
            <iframe id="npcSelectionFrame" src="npcselection.html" frameborder="0"></iframe>
            <button class="close-modal-btn" onclick="closeNPCSelectionModal()">✕</button>
        </div>
    </div>

    <!-- Ongoing Expedition Summary Modal -->
    <div class="expedition-summary-modal" id="expeditionSummaryModal" style="display: none;">
        <div class="summary-modal-content">
            <div class="summary-modal-header">
                <h2 class="summary-modal-title">ONGOING EXPEDITION</h2>
                <button class="close-modal-btn" onclick="closeExpeditionSummaryModal()">✕</button>
            </div>
            
            <div class="summary-modal-body">
                <div class="expedition-progress-section">
                    <div class="progress-header">
                        <h3 class="expedition-name" id="summaryExpeditionName">Medium Expedition</h3>
                        <div class="expedition-location" id="summaryExpeditionLocation">Abandoned Suburbs</div>
                    </div>
                    
                    <div class="time-remaining-display">
                        <div class="time-label">TIME REMAINING</div>
                        <div class="time-value" id="summaryTimeRemaining">3 days</div>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="expeditionProgressFill" style="width: 25%;"></div>
                        </div>
                        <div class="progress-text">Day 1 of 4</div>
                    </div>
                </div>
                
                <div class="expedition-team-section">
                    <h4 class="team-title">EXPEDITION TEAM</h4>
                    <div class="team-members" id="summaryTeamMembers">
                        <!-- Team members will be populated here -->
                    </div>
                </div>
                
                <div class="expedition-stats-section">
                    <div class="stat-item">
                        <div class="stat-label">Success Chance</div>
                        <div class="stat-value" id="summarySuccessChance">75%</div>
                    </div>
                   
                </div>
                
                
            </div>
        </div>
    </div>

    <!-- Post-Expedition Rewards Modal -->
    <div class="post-expedition-modal" id="postExpeditionModal" style="display: none;">
        <div class="post-expedition-modal-content">
            <div class="post-expedition-modal-header">
                <h2 class="post-expedition-modal-title">EXPEDITION COMPLETE</h2>
                <button class="close-modal-btn" onclick="closePostExpeditionModal()">✕</button>
            </div>
            
            <div class="post-expedition-modal-body">
                <div class="expedition-result-section">
                    <div class="expedition-success-badge">
                        <i class="fas fa-check-circle"></i>
                        <span>SUCCESS</span>
                    </div>
                    <div class="expedition-details">
                        <h3 class="expedition-name" id="postExpeditionName">Medium Expedition</h3>
                        <div class="expedition-location" id="postExpeditionLocation">Abandoned Suburbs</div>
                    </div>
                </div>
                
                <div class="rewards-section">
                    <h4 class="rewards-title">RESOURCES FOUND</h4>
                    <div class="resources-grid" id="postExpeditionResources">
                        <div class="resource-item">
                            <div class="resource-icon">
                                <i class="fas fa-flask" style="color: #4169E1;"></i>
                            </div>
                            <div class="resource-info">
                                <div class="resource-name">Research Points</div>
                                <div class="resource-amount">+25</div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-icon">
                                <i class="fas fa-apple-alt" style="color: #FFD700;"></i>
                            </div>
                            <div class="resource-info">
                                <div class="resource-name">Food</div>
                                <div class="resource-amount">+150</div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-icon">
                                <i class="fas fa-bomb" style="color: #32CD32;"></i>
                            </div>
                            <div class="resource-info">
                                <div class="resource-name">Ammunition</div>
                                <div class="resource-amount">+80</div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-icon">
                                <i class="fas fa-cog" style="color: #FF8C42;"></i>
                            </div>
                            <div class="resource-info">
                                <div class="resource-name">Resources</div>
                                <div class="resource-amount">+200</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="team-return-section">
                    <h4 class="team-title">TEAM RETURNED</h4>
                    <div class="returned-team-members" id="postExpeditionTeam">
                        <!-- Team members will be populated here -->
                    </div>
                </div>
                
                <div class="post-expedition-actions">
                    <button class="claim-rewards-btn" onclick="claimExpeditionRewards()">
                        <i class="fas fa-gift"></i>
                        CLAIM REWARDS
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AOE Targeting Overlay -->
    <div class="aoe-targeting-overlay" id="aoeTargetingOverlay">
        <div class="aoe-circle" id="aoeCircle"></div>
    </div>

    <!-- Booster Confirmation Modal -->
    <div class="booster-confirmation-modal" id="boosterConfirmationModal" style="display: none;">
        <div class="confirmation-box">
            <div class="confirmation-icon" id="confirmationIcon">⚡</div>
            <div class="confirmation-title" id="confirmationTitle">Use Booster?</div>
            <div class="confirmation-message" id="confirmationMessage">Are you sure you want to use this booster?</div>
            <div class="confirmation-buttons">
                <button class="confirmation-btn yes" onclick="confirmBoosterUse()">Yes</button>
                <button class="confirmation-btn no" onclick="cancelBoosterUse()">No</button>
            </div>
        </div>
    </div>


    
    <script src="../scripts/script.js"></script>
    
    <script>
        // Traveler's Trade Modal Functions
        function show3DayOfferingsModal() {
            const modal = document.getElementById('offeringsModal');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.8s ease-out';
            console.log('Traveler\'s Trade Modal opened');
        }

        function close3DayOfferingsModal() {
            const modal = document.getElementById('offeringsModal');
            modal.style.animation = 'fadeOut 0.5s ease-out forwards';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
            console.log('Traveler\'s Trade Modal closed');
        }

        // Expedition Planning Modal Functions
        function showExpeditionPlanningModal() {
            const modal = document.getElementById('expeditionPlanningModal');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.8s ease-out';
            console.log('Expedition Planning Modal opened');
        }

        function closeExpeditionPlanningModal() {
            const modal = document.getElementById('expeditionPlanningModal');
            modal.style.animation = 'fadeOut 0.5s ease-out forwards';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
            console.log('Expedition Planning Modal closed');
        }

        // NPC Selection Modal Functions
        function showNPCSelectionModal() {
            const modal = document.getElementById('npcSelectionModal');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.8s ease-out';
            console.log('NPC Selection Modal opened');
        }

        function closeNPCSelectionModal() {
            const modal = document.getElementById('npcSelectionModal');
            modal.style.animation = 'fadeOut 0.5s ease-out forwards';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
            console.log('NPC Selection Modal closed');
        }

        // Effects System for HUD
        let hudGameState = {
            npcs: {
                soldier: false,
                medic: false,
                engineer: false,
                scout: false
            },
            resources: {
                food: 52, // Match the HUD display
                population: 45, // Match the HUD display
                dailyFoodRequirement: 2
            },
            effects: {
                buffs: [],
                debuffs: []
            }
        };

        // Effect definitions for HUD
        const hudEffectDefinitions = {
            soldier_leadership: {
                id: "soldier_leadership",
                name: "Soldier's Leadership",
                type: "buff",
                source: "Sgt. Jackson",
                icon: "fas fa-chevron-up",
                description: "All soldiers deal increased damage",
                value: "+20% Damage",
                category: "combat"
            },
            medical_support: {
                id: "medical_support",
                name: "Medical Support",
                type: "buff",
                source: "Dr. Chen",
                icon: "fas fa-plus-circle",
                description: "Enhanced healing rate for all units",
                value: "+30% Healing",
                category: "support"
            },
            engineering_expertise: {
                id: "engineering_expertise",
                name: "Engineering Expertise",
                type: "buff",
                source: "Maya Rodriguez",
                icon: "fas fa-cog",
                description: "Faster building construction speed",
                value: "+25% Build Speed",
                category: "construction"
            },
            scout_intel: {
                id: "scout_intel",
                name: "Scout's Intelligence",
                type: "buff",
                source: "Marcus Reed",
                icon: "fas fa-eye",
                description: "Improved resource gathering efficiency",
                value: "+15% Resources",
                category: "economy"
            },
            hunger_debuff: {
                id: "hunger_debuff",
                name: "Hunger",
                type: "debuff",
                source: "Food Shortage",
                icon: "fas fa-skull",
                description: "Soldiers weakened by lack of food",
                value: "-50% Damage & HP",
                category: "survival",
                severity: "critical"
            }
        };

        function updateHUDEffectsDisplay() {
            const effectsPanel = document.getElementById('effectsPanel');

            // Clear existing effects
            effectsPanel.innerHTML = '';

            // Combine all effects (buffs and debuffs)
            const allEffects = [
                ...hudGameState.effects.buffs.map(id => hudEffectDefinitions[id]),
                ...hudGameState.effects.debuffs.map(id => hudEffectDefinitions[id])
            ].filter(effect => effect); // Remove any undefined effects

            // Display all effects vertically
            allEffects.forEach(effect => {
                effectsPanel.appendChild(createSimpleEffectIcon(effect));
            });
        }

        function createSimpleEffectIcon(effect) {
            const icon = document.createElement('div');
            icon.className = `effect-icon-simple ${effect.type}`;
            
            icon.innerHTML = `
                <i class="${effect.icon}"></i>
                <div class="effect-tooltip-simple">
                    <div class="tooltip-title-simple">${effect.name}</div>
                    <div class="tooltip-description-simple">${effect.description}</div>
                    <div class="tooltip-source-simple">Source: ${effect.source}</div>
                    <div class="tooltip-value-simple">${effect.value}</div>
                </div>
            `;

            return icon;
        }

        function checkHUDHungerDebuff() {
            const requiredFood = hudGameState.resources.population * hudGameState.resources.dailyFoodRequirement;
            const hasHungerDebuff = hudGameState.effects.debuffs.includes('hunger_debuff');

            if (hudGameState.resources.food < requiredFood) {
                // Apply hunger debuff
                if (!hasHungerDebuff) {
                    hudGameState.effects.debuffs.push('hunger_debuff');
                }
            } else {
                // Remove hunger debuff
                if (hasHungerDebuff) {
                    hudGameState.effects.debuffs = hudGameState.effects.debuffs.filter(id => id !== 'hunger_debuff');
                }
            }

            updateHUDEffectsDisplay();
        }

        // Demo functions to test the system (remove in production)
        function toggleHUDNPCBuff(npcType) {
            const npcEffectMap = {
                soldier: 'soldier_leadership',
                medic: 'medical_support',
                engineer: 'engineering_expertise',
                scout: 'scout_intel'
            };

            const effectId = npcEffectMap[npcType];
            if (!effectId) return;

            hudGameState.npcs[npcType] = !hudGameState.npcs[npcType];

            if (hudGameState.npcs[npcType]) {
                // Add buff
                if (!hudGameState.effects.buffs.includes(effectId)) {
                    hudGameState.effects.buffs.push(effectId);
                }
            } else {
                // Remove buff
                hudGameState.effects.buffs = hudGameState.effects.buffs.filter(id => id !== effectId);
            }

            updateHUDEffectsDisplay();
        }

        // Initialize HUD effects system
        function initializeHUDEffects() {
            checkHUDHungerDebuff();
            updateHUDEffectsDisplay();
            
            // Demo: Add some initial effects for testing
            setTimeout(() => {
                toggleHUDNPCBuff('soldier');
                toggleHUDNPCBuff('medic');
            }, 2000);
        }

        // Boosters System
        let boostersState = {
            isDrawerOpen: false,
            currentBooster: null,
            isTargeting: false,
            boosters: [
                {
                    id: 'repair_blast',
                    name: 'Repair Blast',
                    description: 'Instantly repairs all buildings in target area',
                    icon: 'fas fa-tools',
                    type: 'aoe',
                    aoeRadius: 100,
                    count: 3
                },
                {
                    id: 'damage_boost',
                    name: 'Damage Amplifier',
                    description: 'Increases all unit damage in target area for 30 seconds',
                    icon: 'fas fa-crosshairs',
                    type: 'aoe',
                    aoeRadius: 80,
                    count: 2
                },
                {
                    id: 'resource_collector',
                    name: 'Resource Collector',
                    description: 'Next 6 resource collections are doubled',
                    icon: 'fas fa-gem',
                    type: 'passive',
                    count: 4
                },
                {
                    id: 'speed_boost',
                    name: 'Speed Boost',
                    description: 'All units move 50% faster for 60 seconds',
                    icon: 'fas fa-tachometer-alt',
                    type: 'passive',
                    count: 2
                },
                {
                    id: 'shield_dome',
                    name: 'Shield Dome',
                    description: 'Creates protective shield over target area',
                    icon: 'fas fa-shield-alt',
                    type: 'aoe',
                    aoeRadius: 120,
                    count: 1
                }
            ]
        };

        function toggleBoostersDrawer() {
            const button = document.getElementById('boostersBtn');
            const drawer = document.getElementById('boostersDrawer');
            const expandIcon = document.getElementById('boostersExpandIcon');
            const boostersList = document.getElementById('boostersList');

            boostersState.isDrawerOpen = !boostersState.isDrawerOpen;

            if (boostersState.isDrawerOpen) {
                button.classList.add('expanded');
                drawer.classList.add('expanded');
                expandIcon.style.transform = 'translateY(-50%) rotate(180deg)';
                
                // Wait for drawer animation to complete before populating
                setTimeout(() => {
                    populateBoostersList();
                }, 150);
            } else {
                // Hide tooltip when closing drawer
                if (globalBoosterTooltip) {
                    globalBoosterTooltip.classList.remove('show');
                    globalBoosterTooltip.style.display = 'none';
                }
                
                // Clear booster items immediately to prevent display issues
                if (boostersList) {
                    boostersList.innerHTML = '';
                }
                
                button.classList.remove('expanded');
                drawer.classList.remove('expanded');
                expandIcon.style.transform = 'translateY(-50%) rotate(0deg)';
            }
        }

        function populateBoostersList() {
            const boostersList = document.getElementById('boostersList');

            // Clear existing items
            boostersList.innerHTML = '';

            // Populate boosters
            boostersState.boosters.forEach(booster => {
                if (booster.count > 0) {
                    const boosterItem = createBoosterItem(booster);
                    boostersList.appendChild(boosterItem);
                }
            });
        }

        // Global tooltip element
        let globalBoosterTooltip = null;

        function createGlobalBoosterTooltip() {
            if (!globalBoosterTooltip) {
                globalBoosterTooltip = document.createElement('div');
                globalBoosterTooltip.className = 'booster-tooltip global-tooltip';
                globalBoosterTooltip.style.display = 'none';
                document.body.appendChild(globalBoosterTooltip);
            }
            return globalBoosterTooltip;
        }

        function createBoosterItem(booster) {
            const item = document.createElement('div');
            item.className = 'booster-item';
            item.onclick = () => selectBooster(booster);

            const typeText = booster.type === 'aoe' ? 'AOE Targetable' : 'Passive Booster';

            item.innerHTML = `
                <i class="${booster.icon}"></i>
                <div class="booster-count-badge">${booster.count}</div>
            `;

            // Add mouse event listeners for global tooltip
            item.addEventListener('mouseenter', function(e) {
                const tooltip = createGlobalBoosterTooltip();
                const rect = this.getBoundingClientRect();
                
                console.log('Booster hover detected:', booster.name, 'Rect:', rect);
                
                // Update tooltip content
                tooltip.innerHTML = `
                    <div class="booster-tooltip-title">${booster.name}</div>
                    <div class="booster-tooltip-description">${booster.description}</div>
                    <div class="booster-tooltip-type">${typeText}</div>
                `;
                
                // Calculate optimal position for tooltip
                let left = rect.left - 220; // Default to left side
                let top = rect.top - 10;
                
                // If tooltip would go off left edge, position it to the right
                if (left < 10) {
                    left = rect.right + 15;
                }
                
                // If tooltip would go off top edge, position it below
                if (top < 10) {
                    top = rect.bottom + 10;
                }
                
                // If tooltip would go off bottom edge, position it above
                if (top + 150 > window.innerHeight) {
                    top = rect.top - 160;
                }
                
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
                tooltip.classList.add('show');
                
                console.log('Tooltip positioned at:', left, top, 'Element:', tooltip);
            });

            item.addEventListener('mouseleave', function(e) {
                if (globalBoosterTooltip) {
                    globalBoosterTooltip.classList.remove('show');
                }
            });

            return item;
        }

        function selectBooster(booster) {
            boostersState.currentBooster = booster;

            if (booster.type === 'aoe') {
                // Start AOE targeting
                startAOETargeting(booster);
            } else if (booster.type === 'passive') {
                // Show confirmation modal
                showBoosterConfirmation(booster);
            }

            // Close drawer
            toggleBoostersDrawer();
        }

        function startAOETargeting(booster) {
            boostersState.isTargeting = true;
            const overlay = document.getElementById('aoeTargetingOverlay');
            const circle = document.getElementById('aoeCircle');

            // Setup AOE circle
            const radius = booster.aoeRadius;
            circle.style.width = radius * 2 + 'px';
            circle.style.height = radius * 2 + 'px';

            // Show overlay
            overlay.style.display = 'block';

            // Add mouse move listener
            overlay.addEventListener('mousemove', updateAOEPosition);
            overlay.addEventListener('click', executeAOEBooster);

            // Add escape key listener
            document.addEventListener('keydown', cancelAOETargeting);
        }

        function updateAOEPosition(event) {
            const circle = document.getElementById('aoeCircle');
            const radius = parseInt(circle.style.width) / 2;
            
            circle.style.left = (event.clientX - radius) + 'px';
            circle.style.top = (event.clientY - radius) + 'px';
        }

        function executeAOEBooster(event) {
            if (!boostersState.isTargeting) return;

            const booster = boostersState.currentBooster;
            
            // Use the booster
            useBooster(booster);
            
            // Show effect at click position
            showAOEEffect(event.clientX, event.clientY, booster);
            
            // Clean up
            endAOETargeting();
            
            // Show notification
            showNotification('success', 'Booster Used!', `${booster.name} activated at target location!`);
        }

        function cancelAOETargeting(event) {
            if (event.key === 'Escape' && boostersState.isTargeting) {
                endAOETargeting();
            }
        }

        function endAOETargeting() {
            boostersState.isTargeting = false;
            const overlay = document.getElementById('aoeTargetingOverlay');
            
            overlay.style.display = 'none';
            overlay.removeEventListener('mousemove', updateAOEPosition);
            overlay.removeEventListener('click', executeAOEBooster);
            document.removeEventListener('keydown', cancelAOETargeting);
            
            boostersState.currentBooster = null;
        }

        function showAOEEffect(x, y, booster) {
            // Create visual effect at target location
            const effect = document.createElement('div');
            effect.style.position = 'fixed';
            effect.style.left = (x - booster.aoeRadius) + 'px';
            effect.style.top = (y - booster.aoeRadius) + 'px';
            effect.style.width = (booster.aoeRadius * 2) + 'px';
            effect.style.height = (booster.aoeRadius * 2) + 'px';
            effect.style.border = '3px solid #00ff80';
            effect.style.borderRadius = '50%';
            effect.style.background = 'rgba(0, 255, 128, 0.3)';
            effect.style.boxShadow = '0 0 30px rgba(0, 255, 128, 0.6)';
            effect.style.animation = 'aoeBlast 1s ease-out forwards';
            effect.style.pointerEvents = 'none';
            effect.style.zIndex = '1500';

            document.body.appendChild(effect);

            // Add blast animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes aoeBlast {
                    0% { transform: scale(0); opacity: 1; }
                    50% { transform: scale(1); opacity: 0.8; }
                    100% { transform: scale(1.2); opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            // Remove effect after animation
            setTimeout(() => {
                document.body.removeChild(effect);
                document.head.removeChild(style);
            }, 1000);
        }

        function showBoosterConfirmation(booster) {
            const modal = document.getElementById('boosterConfirmationModal');
            const icon = document.getElementById('confirmationIcon');
            const title = document.getElementById('confirmationTitle');
            const message = document.getElementById('confirmationMessage');

            icon.innerHTML = `<i class="${booster.icon}"></i>`;
            title.textContent = `Use ${booster.name}?`;
            message.textContent = `${booster.description}\n\nThis will consume 1 ${booster.name}. Continue?`;

            modal.style.display = 'flex';
        }

        function confirmBoosterUse() {
            const booster = boostersState.currentBooster;
            
            // Use the booster
            useBooster(booster);
            
            // Add to active effects if it's a passive booster
            if (booster.type === 'passive') {
                addPassiveBoosterEffect(booster);
            }
            
            // Close modal
            cancelBoosterUse();
            
            // Show notification
            showNotification('success', 'Booster Activated!', `${booster.name} is now active!`);
        }

        function cancelBoosterUse() {
            const modal = document.getElementById('boosterConfirmationModal');
            modal.style.display = 'none';
            boostersState.currentBooster = null;
        }

        function useBooster(booster) {
            // Decrease count
            const boosterIndex = boostersState.boosters.findIndex(b => b.id === booster.id);
            if (boosterIndex !== -1) {
                boostersState.boosters[boosterIndex].count--;
            }
            
            // Update drawer if open
            if (boostersState.isDrawerOpen) {
                populateBoostersList();
            }
        }

        function addPassiveBoosterEffect(booster) {
            // Add booster effect to the effects system
            const effectId = booster.id + '_effect';
            
            // Create effect definition
            hudEffectDefinitions[effectId] = {
                id: effectId,
                name: booster.name,
                type: 'buff',
                source: 'Booster',
                icon: booster.icon,
                description: booster.description,
                value: 'Active',
                category: 'booster'
            };
            
            // Add to active effects
            if (!hudGameState.effects.buffs.includes(effectId)) {
                hudGameState.effects.buffs.push(effectId);
            }
            
            // Update effects display
            updateHUDEffectsDisplay();
        }

        function showNotification(type, title, message) {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            // Create new notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-icon">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                    </div>
                    <div class="notification-text">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                </div>
            `;

            document.body.appendChild(notification);

            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);

            // Auto-hide after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        function selectSpecialist(specialistId) {
            console.log('Selected specialist:', specialistId);
            alert(`You have selected ${specialistId.replace('-', ' ').toUpperCase()}!\n\nSpecialist will be added to your base.`);
            closeNPCSelectionModal();
        }

        // Add event listeners for buttons
        document.addEventListener('DOMContentLoaded', function() {
            const recruitButton = document.getElementById('npc-recruit-btn');
            if (recruitButton) {
                recruitButton.addEventListener('click', showNPCSelectionModal);
            }
            
            const expeditionButton = document.getElementById('expeditionPlanningBtn');
            if (expeditionButton) {
                expeditionButton.addEventListener('click', showExpeditionPlanningModal);
            }
            
            const offeringsButton = document.getElementById('offeringsBtn');
            if (offeringsButton) {
                offeringsButton.addEventListener('click', show3DayOfferingsModal);
            }

            // Listen for messages from the iframe
            window.addEventListener('message', function(event) {
                if (event.data.type === 'specialist-selected') {
                    selectSpecialist(event.data.specialist);
                } else if (event.data.type === 'modal-close') {
                    closeNPCSelectionModal();
                } else if (event.data.type === 'expedition-deployed') {
                    // Handle expedition deployment
                    const expeditionData = event.data.data;
                    startExpedition(expeditionData);
                    closeExpeditionPlanningModal();
                }
            });

            // Add hover sound effects for NPC cards
            document.querySelectorAll('.npc-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    console.log('Playing hover sound for:', this.dataset.specialist);
                });
            });

            // Keyboard controls for modals
            document.addEventListener('keydown', function(e) {
                const npcModal = document.getElementById('npcSelectionModal');
                const expeditionModal = document.getElementById('expeditionPlanningModal');
                const offeringsModal = document.getElementById('offeringsModal');
                const postExpeditionModal = document.getElementById('postExpeditionModal');
                
                if (npcModal.style.display === 'flex') {
                    if (e.key === 'Escape') {
                        closeNPCSelectionModal();
                    } else if (e.key === '1') {
                        selectSpecialist('sarah-chen');
                    } else if (e.key === '2') {
                        selectSpecialist('marcus-daniels');
                    }
                }
                
                if (expeditionModal.style.display === 'flex') {
                    if (e.key === 'Escape') {
                        closeExpeditionPlanningModal();
                    }
                }
                
                if (offeringsModal.style.display === 'flex') {
                    if (e.key === 'Escape') {
                        close3DayOfferingsModal();
                    }
                }
                
                if (postExpeditionModal.style.display === 'flex') {
                    if (e.key === 'Escape') {
                        closePostExpeditionModal();
                    } else if (e.key === 'Enter') {
                        claimExpeditionRewards();
                    }
                }

                // Demo keyboard controls for effects (remove in production)
                if (e.key === 'b' && e.ctrlKey) {
                    toggleHUDNPCBuff('soldier');
                } else if (e.key === 'm' && e.ctrlKey) {
                    toggleHUDNPCBuff('medic');
                } else if (e.key === 'e' && e.ctrlKey) {
                    toggleHUDNPCBuff('engineer');
                } else if (e.key === 's' && e.ctrlKey) {
                    toggleHUDNPCBuff('scout');
                } else if (e.key === 'h' && e.ctrlKey) {
                    // Toggle hunger simulation
                    hudGameState.resources.food = hudGameState.resources.food < 90 ? 120 : 30;
                    checkHUDHungerDebuff();
                } else if (e.key === 'x' && e.ctrlKey) {
                    // Demo: Start expedition (remove in production)
                    const demoExpedition = {
                        type: 'medium',
                        team: [
                            { id: 'marcus', name: 'Marcus Reed', role: 'Scout', icon: 'fas fa-search', power: 70 },
                            { id: 'jackson', name: 'Sgt. Jackson', role: 'Soldier', icon: 'fas fa-user-soldier', power: 85 }
                        ],
                        successChance: 75
                    };
                    startExpedition(demoExpedition);
                } else if (e.key === 'c' && e.ctrlKey) {
                    // Demo: Quick completion expedition (remove in production)
                    const quickExpedition = {
                        type: 'small',
                        team: [
                            { id: 'test', name: 'Test Scout', role: 'Scout', icon: 'fas fa-eye', power: 80 }
                        ],
                        successChance: 95
                    };
                    
                    // Start expedition and complete it immediately for testing
                    startExpedition(quickExpedition);
                    
                    // Complete after 2 seconds for demonstration
                    setTimeout(() => {
                        const activeSlotIndex = expeditionSlots.findIndex(slot => slot.isActive);
                        if (activeSlotIndex !== -1) {
                            completeExpeditionInSlot(activeSlotIndex);
                        }
                    }, 2000);
                } else if (e.key === 'f' && e.ctrlKey) {
                    // Demo: Quick failed expedition (remove in production)
                    const failedExpedition = {
                        type: 'medium',
                        team: [
                            { id: 'test1', name: 'Test Soldier', role: 'Soldier', icon: 'fas fa-user-shield', power: 60 },
                            { id: 'test2', name: 'Test Medic', role: 'Medic', icon: 'fas fa-user-md', power: 55 }
                        ],
                        successChance: 30
                    };
                    
                    // Start expedition and fail it immediately for testing
                    startExpedition(failedExpedition);
                    
                    // Fail after 2 seconds for demonstration
                    setTimeout(() => {
                        const activeSlotIndex = expeditionSlots.findIndex(slot => slot.isActive);
                        if (activeSlotIndex !== -1) {
                            completeExpeditionInSlot(activeSlotIndex, true); // Force fail
                        }
                    }, 2000);
                }
            });

            // Add fadeOut animation dynamically
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            // Initialize HUD effects system
            initializeHUDEffects();
            
            // Initialize expedition slots
            initializeExpeditionSlots();
        });

        // Expedition Slots System (Max 3 expeditions)
        let expeditionSlots = [
            { isActive: false, isCompleted: false, expedition: null },
            { isActive: false, isCompleted: false, expedition: null },
            { isActive: false, isCompleted: false, expedition: null }
        ];

        // Expedition type data
        const expeditionTypes = {
            small: {
                name: 'Small Expedition',
                location: 'Desert Ruins',
                duration: 3,
                icon: 'fas fa-home'
            },
            medium: {
                name: 'Medium Expedition',
                location: 'Abandoned Suburbs',
                duration: 4,
                icon: 'fas fa-city'
            },
            large: {
                name: 'Large Expedition',
                location: 'Military Lab Complex',
                duration: 5,
                icon: 'fas fa-industry'
            }
        };

        function startExpedition(expeditionData) {
            // Find available slot
            const availableSlotIndex = expeditionSlots.findIndex(slot => !slot.isActive);
            
            if (availableSlotIndex === -1) {
                showNotification('warning', 'No Available Slots', 'All expedition slots are currently occupied. Recall an expedition to free up a slot.');
                return;
            }

            const typeData = expeditionTypes[expeditionData.type];
            
            const expedition = {
                isActive: true,
                type: expeditionData.type,
                name: typeData.name,
                location: typeData.location,
                duration: typeData.duration,
                startTime: Date.now(),
                endTime: Date.now() + (typeData.duration * 24 * 60 * 60 * 1000), // Convert days to milliseconds
                team: expeditionData.team || [],
                successChance: expeditionData.successChance || 0,
                expeditionIcon: typeData.icon,
                slotIndex: availableSlotIndex + 1
            };

            expeditionSlots[availableSlotIndex] = {
                isActive: true,
                expedition: expedition
            };

            updateExpeditionSlotDisplay(availableSlotIndex + 1, expedition, 'active');
            startExpeditionTimerForSlot(availableSlotIndex);
            
            console.log('Expedition started in slot', availableSlotIndex + 1, ':', expedition);
        }

        function updateExpeditionSlotDisplay(slotNumber, expedition, state = 'active', expeditionResult = null) {
            const slot = document.getElementById(`expeditionSlot${slotNumber}`);
            const slotIcon = slot.querySelector('.slot-icon');
            const slotText = slot.querySelector('.slot-text');

            // Remove all state classes
            slot.classList.remove('active', 'empty', 'completed', 'failed');

            if (expedition && state === 'completed') {
                // Check if expedition was successful or failed
                if (expeditionResult && expeditionResult.success === false) {
                    // Failed expedition - show red X
                    slot.classList.add('failed');
                    slotIcon.className = 'fas fa-times slot-icon';
                    slotText.textContent = 'Failed';
                } else {
                    // Successful expedition - show green checkmark
                    slot.classList.add('completed');
                    slotIcon.className = 'fas fa-check slot-icon';
                    slotText.textContent = 'Complete';
                }
            } else if (expedition && state === 'active') {
                // Slot is active with expedition
                slot.classList.add('active');
                slotIcon.className = expedition.expeditionIcon + ' slot-icon';
                
                const timeRemaining = getTimeRemainingForSlot(slotNumber - 1);
                slotText.textContent = formatTimeRemainingShort(timeRemaining);
            } else {
                // Slot is empty
                slot.classList.add('empty');
                slotIcon.className = 'fas fa-plus slot-icon';
                slotText.textContent = 'Empty';
            }
        }

        function getTimeRemainingForSlot(slotIndex) {
            const slot = expeditionSlots[slotIndex];
            if (!slot.isActive || !slot.expedition) return 0;
            
            const now = Date.now();
            const remaining = Math.max(0, slot.expedition.endTime - now);
            
            return remaining;
        }

        function formatTimeRemainingShort(milliseconds) {
            const days = Math.floor(milliseconds / (24 * 60 * 60 * 1000));
            const hours = Math.floor((milliseconds % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
            
            if (days > 0) {
                return `${days}d`;
            } else if (hours > 0) {
                return `${hours}h`;
            } else {
                return 'Soon';
            }
        }

        function startExpeditionTimerForSlot(slotIndex) {
            const timer = setInterval(() => {
                const slot = expeditionSlots[slotIndex];
                
                if (!slot.isActive || !slot.expedition) {
                    clearInterval(timer);
                    return;
                }

                const timeRemaining = getTimeRemainingForSlot(slotIndex);
                
                if (timeRemaining <= 0) {
                    // Expedition complete
                    completeExpeditionInSlot(slotIndex);
                    clearInterval(timer);
                } else {
                    // Update slot display
                    updateExpeditionSlotDisplay(slotIndex + 1, slot.expedition, 'active');
                }
            }, 60000); // Update every minute
        }

        function completeExpeditionInSlot(slotIndex, forceFail = false) {
            const slot = expeditionSlots[slotIndex];
            if (!slot.isActive || !slot.expedition) return;

            const expedition = slot.expedition;
            
            // Determine if expedition succeeds or fails
            const successChance = expedition.successChance || 75;
            const isSuccess = forceFail ? false : Math.random() * 100 < successChance;
            
            // Generate rewards based on expedition type and success
            const rewards = generateExpeditionRewards(expedition, isSuccess);
            
            // Set the slot to completed state
            expeditionSlots[slotIndex] = { 
                isActive: false, 
                isCompleted: true, 
                expedition: expedition,
                rewards: rewards
            };
            
            // Update slot display to show completed state
            updateExpeditionSlotDisplay(slotIndex + 1, expedition, 'completed', rewards);
            
            // Show completion notification
            if (isSuccess) {
                showNotification('success', 'Expedition Complete!', 
                    `${expedition.name} has returned with valuable resources and intelligence. Click the slot to claim rewards!`);
            } else {
                showNotification('warning', 'Expedition Failed!', 
                    `${expedition.name} has failed. Check the expedition slot for details about what happened.`);
            }
            
            console.log('Expedition completed in slot', slotIndex + 1, 'Success:', isSuccess);
        }

        // Failed expedition stories
        const failedExpeditionStories = [
            "Our NPCs haven't returned to base. Rumors say they got bitten in the supermarket while looting for food.",
            "Last transmission indicated they were overwhelmed by a massive horde at the old gas station. No survivors found.",
            "The team encountered hostile survivors who ambushed them at the checkpoint. Their equipment was later discovered abandoned.",
            "A structural collapse at the target location trapped the entire team. Search and rescue efforts have been unsuccessful.",
            "Communication was lost during a severe storm. Their last known position was overrun by infected within hours.",
            "The expedition triggered a security system at the military facility. Automated defenses eliminated all team members.",
            "A rival faction intercepted our team at the extraction point. Intelligence suggests they were taken prisoner but later executed."
        ];

        function generateExpeditionRewards(expedition, isSuccess = true) {
            if (!isSuccess) {
                // Return failed expedition data
                return {
                    success: false,
                    story: failedExpeditionStories[Math.floor(Math.random() * failedExpeditionStories.length)],
                    casualties: expedition.team.length,
                    resources: [] // No resources for failed expeditions
                };
            }

            // Generate rewards based on expedition type and success
            const baseRewards = {
                small: {
                    resources: [
                        { name: 'Research Points', amount: 10 + Math.floor(Math.random() * 15), icon: 'fas fa-flask', color: '#4169E1' },
                        { name: 'Food', amount: 80 + Math.floor(Math.random() * 40), icon: 'fas fa-apple-alt', color: '#FFD700' },
                        { name: 'Ammunition', amount: 30 + Math.floor(Math.random() * 20), icon: 'fas fa-bomb', color: '#32CD32' },
                        { name: 'Resources', amount: 100 + Math.floor(Math.random() * 50), icon: 'fas fa-cog', color: '#FF8C42' }
                    ]
                },
                medium: {
                    resources: [
                        { name: 'Research Points', amount: 20 + Math.floor(Math.random() * 25), icon: 'fas fa-flask', color: '#4169E1' },
                        { name: 'Food', amount: 120 + Math.floor(Math.random() * 60), icon: 'fas fa-apple-alt', color: '#FFD700' },
                        { name: 'Ammunition', amount: 60 + Math.floor(Math.random() * 40), icon: 'fas fa-bomb', color: '#32CD32' },
                        { name: 'Resources', amount: 150 + Math.floor(Math.random() * 80), icon: 'fas fa-cog', color: '#FF8C42' }
                    ]
                },
                large: {
                    resources: [
                        { name: 'Research Points', amount: 35 + Math.floor(Math.random() * 40), icon: 'fas fa-flask', color: '#4169E1' },
                        { name: 'Food', amount: 200 + Math.floor(Math.random() * 100), icon: 'fas fa-apple-alt', color: '#FFD700' },
                        { name: 'Ammunition', amount: 100 + Math.floor(Math.random() * 60), icon: 'fas fa-bomb', color: '#32CD32' },
                        { name: 'Resources', amount: 250 + Math.floor(Math.random() * 120), icon: 'fas fa-cog', color: '#FF8C42' }
                    ]
                }
            };

            const rewards = baseRewards[expedition.type] || baseRewards.medium;
            return {
                success: true,
                ...rewards
            };
        }

        function showExpeditionSlotSummary(slotNumber) {
            const slotIndex = slotNumber - 1;
            const slot = expeditionSlots[slotIndex];
            
            if (slot.isCompleted) {
                // Completed expedition - show post-expedition modal
                showPostExpeditionModal(slotIndex);
                return;
            }
            
            if (!slot.isActive || !slot.expedition) {
                // Empty slot - show expedition planning modal
                showExpeditionPlanningModal();
                return;
            }

            const expedition = slot.expedition;
            const modal = document.getElementById('expeditionSummaryModal');
            
            // Update modal content
            document.getElementById('summaryExpeditionName').textContent = expedition.name;
            document.getElementById('summaryExpeditionLocation').textContent = expedition.location;
            document.getElementById('summaryTimeRemaining').textContent = formatTimeRemaining(getTimeRemainingForSlot(slotIndex));
            document.getElementById('summarySuccessChance').textContent = expedition.successChance + '%';
            
            // Update progress bar
            const elapsed = Date.now() - expedition.startTime;
            const total = expedition.endTime - expedition.startTime;
            const progress = Math.min(100, (elapsed / total) * 100);
            
            document.getElementById('expeditionProgressFill').style.width = progress + '%';
            
            const currentDay = Math.floor(elapsed / (24 * 60 * 60 * 1000)) + 1;
            document.querySelector('.progress-text').textContent = `Day ${currentDay} of ${expedition.duration}`;
            
            // Update team members
            const teamMembersContainer = document.getElementById('summaryTeamMembers');
            teamMembersContainer.innerHTML = '';
            
            expedition.team.forEach(member => {
                const memberElement = document.createElement('div');
                memberElement.className = 'team-member';
                memberElement.innerHTML = `
                    <div class="member-portrait">
                        <i class="${member.icon}"></i>
                    </div>
                    <div class="member-info">
                        <div class="member-name">${member.name}</div>
                        <div class="member-role">${member.role}</div>
                    </div>
                `;
                teamMembersContainer.appendChild(memberElement);
            });
            
            // Store current slot for recall function
            modal.setAttribute('data-slot-number', slotNumber);
            
            modal.style.display = 'flex';
        }

        // Initialize all slots as empty
        function initializeExpeditionSlots() {
            // Reset expedition slots array
            expeditionSlots = [
                { isActive: false, isCompleted: false, expedition: null },
                { isActive: false, isCompleted: false, expedition: null },
                { isActive: false, isCompleted: false, expedition: null }
            ];
            
            // Add a mock-up successful expedition in slot 1 for demonstration
            const mockCompletedExpedition = {
                type: 'medium',
                name: 'Medium Expedition',
                location: 'Abandoned Suburbs',
                duration: 4,
                startTime: Date.now() - (4 * 24 * 60 * 60 * 1000), // Started 4 days ago
                endTime: Date.now() - (60 * 60 * 1000), // Ended 1 hour ago
                team: [
                    { id: 'sarah', name: 'Sarah Chen', role: 'Medic', icon: 'fas fa-user-md', power: 85 },
                    { id: 'marcus', name: 'Marcus Daniels', role: 'Soldier', icon: 'fas fa-user-shield', power: 78 },
                    { id: 'alex', name: 'Alex Rivera', role: 'Engineer', icon: 'fas fa-wrench', power: 82 }
                ],
                successChance: 85,
                expeditionIcon: 'fas fa-city',
                slotIndex: 1
            };
            
            const mockSuccessRewards = {
                success: true,
                resources: [
                    { name: 'Research Points', amount: 32, icon: 'fas fa-flask', color: '#4169E1' },
                    { name: 'Food', amount: 167, icon: 'fas fa-apple-alt', color: '#FFD700' },
                    { name: 'Ammunition', amount: 84, icon: 'fas fa-bomb', color: '#32CD32' },
                    { name: 'Resources', amount: 198, icon: 'fas fa-cog', color: '#FF8C42' }
                ]
            };
            
            // Add a mock-up failed expedition in slot 2 for demonstration
            const mockFailedExpedition = {
                type: 'small',
                name: 'Small Expedition',
                location: 'Desert Ruins',
                duration: 3,
                startTime: Date.now() - (3 * 24 * 60 * 60 * 1000), // Started 3 days ago
                endTime: Date.now() - (2 * 60 * 60 * 1000), // Ended 2 hours ago
                team: [
                    { id: 'james', name: 'James Parker', role: 'Scout', icon: 'fas fa-search', power: 70 },
                    { id: 'lisa', name: 'Lisa Wong', role: 'Soldier', icon: 'fas fa-user-shield', power: 65 }
                ],
                successChance: 60,
                expeditionIcon: 'fas fa-home',
                slotIndex: 2
            };
            
            const mockFailedRewards = {
                success: false,
                story: "Our NPCs haven't returned to base. Rumors say they got bitten in the supermarket while looting for food.",
                casualties: 2,
                resources: []
            };
            
            // Set slot 1 as completed with successful expedition
            expeditionSlots[0] = {
                isActive: false,
                isCompleted: true,
                expedition: mockCompletedExpedition,
                rewards: mockSuccessRewards
            };
            
            // Set slot 2 as completed with failed expedition
            expeditionSlots[1] = {
                isActive: false,
                isCompleted: true,
                expedition: mockFailedExpedition,
                rewards: mockFailedRewards
            };
            
            // Update display for all slots
            for (let i = 1; i <= 3; i++) {
                if (i === 1) {
                    // Show successful expedition in slot 1
                    updateExpeditionSlotDisplay(i, mockCompletedExpedition, 'completed', mockSuccessRewards);
                } else if (i === 2) {
                    // Show failed expedition in slot 2
                    updateExpeditionSlotDisplay(i, mockFailedExpedition, 'completed', mockFailedRewards);
                } else {
                    // Show empty slot
                    updateExpeditionSlotDisplay(i, null);
                }
            }
        }

        function formatTimeRemaining(milliseconds) {
            const days = Math.floor(milliseconds / (24 * 60 * 60 * 1000));
            const hours = Math.floor((milliseconds % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
            
            if (days > 0) {
                return `${days} day${days > 1 ? 's' : ''} remaining`;
            } else if (hours > 0) {
                return `${hours} hour${hours > 1 ? 's' : ''} remaining`;
            } else {
                return 'Returning soon';
            }
        }



        function closeExpeditionSummaryModal() {
            const modal = document.getElementById('expeditionSummaryModal');
            modal.style.display = 'none';
        }

        function recallExpedition() {
            const modal = document.getElementById('expeditionSummaryModal');
            const slotNumber = parseInt(modal.getAttribute('data-slot-number'));
            
            if (!slotNumber || slotNumber < 1 || slotNumber > 3) return;
            
            const slotIndex = slotNumber - 1;
            const slot = expeditionSlots[slotIndex];
            
            if (!slot.isActive || !slot.expedition) return;
            
            const confirmRecall = confirm('Are you sure you want to recall the expedition early? This may result in reduced rewards.');
            
            if (confirmRecall) {
                const expedition = slot.expedition;
                
                showNotification('warning', 'Expedition Recalled', 
                    `${expedition.name} has been recalled early and is returning to base.`);
                
                // Clear the slot
                expeditionSlots[slotIndex] = { isActive: false, isCompleted: false, expedition: null };
                
                // Update slot display
                updateExpeditionSlotDisplay(slotNumber, null);
                
                // Close modal
                closeExpeditionSummaryModal();
                
                console.log('Expedition recalled from slot', slotNumber);
            }
        }

        // Post-Expedition Modal Functions
        function showPostExpeditionModal(slotIndex) {
            const slot = expeditionSlots[slotIndex];
            if (!slot.isCompleted || !slot.expedition) return;

            const expedition = slot.expedition;
            const rewards = slot.rewards;
            const modal = document.getElementById('postExpeditionModal');
            
            // Update modal content
            document.getElementById('postExpeditionName').textContent = expedition.name;
            document.getElementById('postExpeditionLocation').textContent = expedition.location;
            
            // Update success/failure badge and title
            const successBadge = document.querySelector('.expedition-success-badge');
            const modalTitle = document.querySelector('.post-expedition-modal-title');
            
            if (rewards.success) {
                // Success case
                successBadge.innerHTML = '<i class="fas fa-check-circle"></i><span>SUCCESS</span>';
                successBadge.style.color = '#22c55e';
                modalTitle.textContent = 'EXPEDITION COMPLETE';
                
                // Update resources
                const resourcesContainer = document.getElementById('postExpeditionResources');
                resourcesContainer.innerHTML = '';
                
                rewards.resources.forEach(resource => {
                    const resourceElement = document.createElement('div');
                    resourceElement.className = 'resource-item';
                    resourceElement.innerHTML = `
                        <div class="resource-icon">
                            <i class="${resource.icon}" style="color: ${resource.color};"></i>
                        </div>
                        <div class="resource-info">
                            <div class="resource-name">${resource.name}</div>
                            <div class="resource-amount">+${resource.amount}</div>
                        </div>
                    `;
                    resourcesContainer.appendChild(resourceElement);
                });
                
                // Update team members (survivors)
                const teamContainer = document.getElementById('postExpeditionTeam');
                teamContainer.innerHTML = '';
                
                expedition.team.forEach(member => {
                    const memberElement = document.createElement('div');
                    memberElement.className = 'returned-team-member';
                    memberElement.innerHTML = `
                        <div class="returned-member-portrait">
                            <i class="${member.icon}"></i>
                        </div>
                        <div class="returned-member-info">
                            <div class="returned-member-name">${member.name}</div>
                            <div class="returned-member-role">${member.role}</div>
                        </div>
                    `;
                    teamContainer.appendChild(memberElement);
                });
                
                // Show rewards section
                document.querySelector('.rewards-section').style.display = 'block';
                document.querySelector('.team-return-section h4').textContent = 'TEAM RETURNED';
                
            } else {
                // Failure case
                successBadge.innerHTML = '<i class="fas fa-times-circle"></i><span>FAILED</span>';
                successBadge.style.color = '#ef4444';
                modalTitle.textContent = 'EXPEDITION FAILED';
                
                // Hide rewards section and show failure story
                document.querySelector('.rewards-section').style.display = 'none';
                
                // Update team section to show casualties
                const teamContainer = document.getElementById('postExpeditionTeam');
                teamContainer.innerHTML = '';
                
                // Show failure story
                const failureStory = document.createElement('div');
                failureStory.className = 'failure-story';
                failureStory.style.cssText = `
                    background: rgba(239, 68, 68, 0.1);
                    border: 1px solid rgba(239, 68, 68, 0.3);
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1rem;
                    color: #ffffff;
                    font-size: 13px;
                    line-height: 1.4;
                    font-style: italic;
                `;
                failureStory.innerHTML = `
                    <div style="color: #ef4444; font-weight: 700; margin-bottom: 0.5rem; font-size: 12px; letter-spacing: 1px;">
                        MISSION REPORT
                    </div>
                    ${rewards.story}
                `;
                teamContainer.appendChild(failureStory);
                
                // Show dead team members
                expedition.team.forEach(member => {
                    const memberElement = document.createElement('div');
                    memberElement.className = 'returned-team-member';
                    memberElement.style.cssText = `
                        opacity: 0.5;
                        background: rgba(239, 68, 68, 0.1);
                        border: 1px solid rgba(239, 68, 68, 0.2);
                    `;
                    memberElement.innerHTML = `
                        <div class="returned-member-portrait" style="background: rgba(239, 68, 68, 0.3); border-color: #ef4444;">
                            <i class="${member.icon}" style="color: #ef4444;"></i>
                        </div>
                        <div class="returned-member-info">
                            <div class="returned-member-name" style="color: #ef4444; text-decoration: line-through;">${member.name}</div>
                            <div class="returned-member-role" style="color: #ef4444; opacity: 0.7;">KIA - ${member.role}</div>
                        </div>
                    `;
                    teamContainer.appendChild(memberElement);
                });
                
                document.querySelector('.team-return-section h4').textContent = 'CASUALTIES';
            }
            
            // Update claim button
            const claimButton = document.querySelector('.claim-rewards-btn');
            if (rewards.success) {
                claimButton.innerHTML = '<i class="fas fa-gift"></i>CLAIM REWARDS';
                claimButton.style.background = 'linear-gradient(145deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.7))';
                claimButton.style.borderColor = '#22c55e';
            } else {
                claimButton.innerHTML = '<i class="fas fa-times"></i>ACKNOWLEDGE';
                claimButton.style.background = 'linear-gradient(145deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.7))';
                claimButton.style.borderColor = '#ef4444';
            }
            
            // Store current slot for claim function
            modal.setAttribute('data-slot-index', slotIndex);
            
            modal.style.display = 'flex';
        }

        function closePostExpeditionModal() {
            const modal = document.getElementById('postExpeditionModal');
            modal.style.display = 'none';
        }

        function claimExpeditionRewards() {
            const modal = document.getElementById('postExpeditionModal');
            const slotIndex = parseInt(modal.getAttribute('data-slot-index'));
            
            if (slotIndex < 0 || slotIndex >= expeditionSlots.length) return;
            
            const slot = expeditionSlots[slotIndex];
            if (!slot.isCompleted || !slot.expedition) return;
            
            const expedition = slot.expedition;
            const rewards = slot.rewards;
            
            // Show appropriate notification based on success/failure
            if (rewards.success) {
                showNotification('success', 'Rewards Claimed!', 
                    `Successfully claimed rewards from ${expedition.name}!`);
            } else {
                showNotification('warning', 'Failure Acknowledged', 
                    `Mission failure acknowledged. The fallen will be remembered.`);
            }
            
            // Clear the slot
            expeditionSlots[slotIndex] = { isActive: false, isCompleted: false, expedition: null };
            
            // Update slot display
            updateExpeditionSlotDisplay(slotIndex + 1, null);
            
            // Close modal
            closePostExpeditionModal();
            
            console.log('Expedition processed from slot', slotIndex + 1, 'Success:', rewards.success);
        }

        // Open settings panel
        function openSettings() {
            // Save current game state if needed
            // For now, just redirect to settings page
            window.location.href = 'settings.html';
        }

        // Test function to trigger end game screen
        function testEndGame() {
            // Set base health to 0 to trigger game over
            if (window.uiManager) {
                window.uiManager.updateBaseHealth(0);
            } else {
                // Fallback: redirect directly to end game screen
                window.location.href = 'end-game.html';
            }
        }
    </script>
</body>
</html> 